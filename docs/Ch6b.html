<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>13&nbsp; Principal Components – Powered by Linear Algebra</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./Ch6c.html" rel="next">
<link href="./Ch6a.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-5e2915e4d4df5928b2b0a61215b328b6.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Ch6b.html"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Principal Components</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Powered by Linear Algebra</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">index.html</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Matrices and Vectors</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Matrix Inverse</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch2a.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Covariance Matrices, MV Normal Distribution</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Linear Statistical Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch3a.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Confidence Sets</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Matrix Rank</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch5a.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Vector Spaces</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch5b.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Inner Product Spaces</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch5bb.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Four Fundamental Spaces</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch5c.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Shrinkage Estimators</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch6a.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Eigenanalysis</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch6b.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Principal Components</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch6c.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Singular Value Decomposition</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch6d.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">A Deeper Look at Overfitting</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch8a.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Attention</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contents</h2>
   
  <ul>
  <li><a href="#the-second-third-etc.-pcs" id="toc-the-second-third-etc.-pcs" class="nav-link active" data-scroll-target="#the-second-third-etc.-pcs"><span class="header-section-number">13.1</span> The Second, Third Etc. PCs</a></li>
  <li><a href="#sec-eiglm" id="toc-sec-eiglm" class="nav-link" data-scroll-target="#sec-eiglm"><span class="header-section-number">13.2</span> Eigenanalysis Relation between <span class="math inline">\(A\)</span> and <span class="math inline">\(Cov(X)\)</span> in Linear Regression</a></li>
  <li><a href="#sec-backtoafrica" id="toc-sec-backtoafrica" class="nav-link" data-scroll-target="#sec-backtoafrica"><span class="header-section-number">13.3</span> Back to the African Soils Example</a></li>
  <li><a href="#sec-detect" id="toc-sec-detect" class="nav-link" data-scroll-target="#sec-detect"><span class="header-section-number">13.4</span> PCA in Detection of Multicollinearity</a></li>
  <li><a href="#sec-prob0" id="toc-sec-prob0" class="nav-link" data-scroll-target="#sec-prob0"><span class="header-section-number">13.5</span> An Important Property of All-Numeric Predictor Data</a></li>
  <li><a href="#how-many-principal-components-should-we-use" id="toc-how-many-principal-components-should-we-use" class="nav-link" data-scroll-target="#how-many-principal-components-should-we-use"><span class="header-section-number">13.6</span> How Many Principal Components Should We Use?</a>
  <ul class="collapse">
  <li><a href="#sec-nyc" id="toc-sec-nyc" class="nav-link" data-scroll-target="#sec-nyc"><span class="header-section-number">13.6.1</span> Example: New York City taxi trips</a></li>
  </ul></li>
  <li><a href="#sec-squareroot" id="toc-sec-squareroot" class="nav-link" data-scroll-target="#sec-squareroot"><span class="header-section-number">13.7</span> A “Square Root” Matrix, and MV Normal Simulation</a></li>
  <li><a href="#your-turn" id="toc-your-turn" class="nav-link" data-scroll-target="#your-turn"><span class="header-section-number">13.8</span> Your Turn</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-pca" class="quarto-section-identifier"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Principal Components</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div style="page-break-after: always;"></div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Goals of this chapter:
</div>
</div>
<div class="callout-body-container callout-body">
<p>It turns out that eigenanalysis can be quite useful for dimension reduction, by determining the <em>principal components</em> of our data. This is the focus of the current chapter.</p>
</div>
</div>
<p>So in the last chapter we had a very brief introduction to Principal Components Analysis (PCA), and that finding the first component entails finding an eigenvector and eigenvalue. It turns out that this is true for the second, third and all the components. In other words, PCA is basically an eigenvectors and eigenvalues application.</p>
<section id="the-second-third-etc.-pcs" class="level2" data-number="13.1">
<h2 data-number="13.1" class="anchored" data-anchor-id="the-second-third-etc.-pcs"><span class="header-section-number">13.1</span> The Second, Third Etc. PCs</h2>
<p>Say we have a dataset <span class="math inline">\(X\)</span> in matrix form. There are as many principal components as there are columns in <span class="math inline">\(X\)</span>. We derived the first PC in <span class="citation" data-cites="secfirstPC">@secfirstPC</span>. So, how are the second, third and so on components defined and computed?</p>
<p>The key issue is that we want our PCs to be orthogonal, because as we have seen orthogonal random vectors are statistically uncorrelated, and independent in the multivariate normal case. So if we summarize our data with say, the first few PCs, the fact that they are uncorrelated makes for a neater summary.</p>
<p>So with <span class="math inline">\(u\)</span> and <span class="math inline">\(v\)</span> denoting the first and second PCs, we want <span class="math inline">\(v\)</span> to maximize <span class="math inline">\(v'Cov(X)v\)</span>, so we set the derivative of</p>
<p><span class="math display">\[
v'Cov(X)v + \omega (v'v - 1) + \tau (u'v - 0)
\]</span></p>
<p>with respect to <span class="math inline">\(v\)</span> to 0.</p>
<p><span id="eq-eig2a"><span class="math display">\[
0 = 2 Cov(X) v + 2 \omega v + \tau u
\tag{13.1}\]</span></span></p>
<p>Pre-multiply by <span class="math inline">\(u'\)</span>:</p>
<p><span id="eq-eig2b"><span class="math display">\[
0 = 2 u' Cov(X) v + 2 \omega u'v + \tau u'u = 2 u' Cov(X) v + \tau 1
\tag{13.2}\]</span></span></p>
<p>Also, since <span class="math inline">\(Cov(X)\)</span> is symmetric and <span class="math inline">\(u\)</span> is an eigenvector of <span class="math inline">\(Cov(X)\)</span>,</p>
<p><span class="math display">\[
u' Cov(X) v = [Cov(X) u]' v = \gamma u' v = 0
\]</span></p>
<p>So <a href="#eq-eig2b" class="quarto-xref">Equation&nbsp;<span>13.2</span></a> now tells us that <span class="math inline">\(\tau = 0\)</span>, and thus <a href="#eq-eig2a" class="quarto-xref">Equation&nbsp;<span>13.1</span></a> reduces to</p>
<p><span id="eq-eig2c"><span class="math display">\[
Cov(X) v = -\omega v
\tag{13.3}\]</span></span></p>
<p>showing that the second PC is again an eigenvector of <span class="math inline">\(Cov(X)\)</span>. <a href="Ch6a.html#eq-maxvar" class="quarto-xref">Equation&nbsp;<span>12.2</span></a> then says that <span class="math inline">\(-\omega\)</span> is the corresponding variance.</p>
<p>The story is the same for the remaining PCs. We thus have:</p>
<div id="thm-thestory" class="theorem">
<p><span class="theorem-title"><strong>Theorem 13.1</strong></span> The principle components have the following properties:</p>
<ul>
<li><p>They are orthogonal to each other.</p></li>
<li><p>They are eigenvectors of <span class="math inline">\(Cov(X)\)</span>.</p></li>
<li><p>The eigenvalue corresponding to a PC <span class="math inline">\(z\)</span> is <span class="math inline">\(Var(z'X)\)</span>.</p></li>
<li><p>The eigenvalues form a nondecreasing sequence.</p></li>
<li><p>Say <span class="math inline">\(X\)</span> is of length <span class="math inline">\(m\)</span>. Normalize the PCs <span class="math inline">\(u_i\)</span> (i.e.&nbsp;divide a PC by its length, so that we have a vector of length 1) and form the <span class="math inline">\(m
\times m\)</span> (partitioned) matrix</p>
<p><span class="math display">\[
P = (u_1 | u_2 | ... | u_m)
\]</span></p>
<p>Then</p>
<p><span id="eq-diagonalize"><span class="math display">\[
P' Cov(X) P = D
\tag{13.4}\]</span></span></p>
<p>where <span class="math inline">\(D\)</span> is a diagonal matrix whose entries are <span class="math inline">\(Var(u_i'X)\)</span>, and <span class="math inline">\(P'P = I\)</span>.</p></li>
</ul>
</div>
</section>
<section id="sec-eiglm" class="level2" data-number="13.2">
<h2 data-number="13.2" class="anchored" data-anchor-id="sec-eiglm"><span class="header-section-number">13.2</span> Eigenanalysis Relation between <span class="math inline">\(A\)</span> and <span class="math inline">\(Cov(X)\)</span> in Linear Regression</h2>
<p>Consider our usual linear regression setting, in which the matrix <span class="math inline">\(A\)</span> contains the data for our predictor variables <span class="math inline">\(X\)</span>. If we center and scale our data, then</p>
<p><span class="math display">\[
Cov(X) = A'A
\]</span></p>
<p>To see an example of the implications of this, say the PCA of X has a 0 eigenvalue. That implies that some linear combination <span class="math inline">\(u'X\)</span> has 0 variance. Then</p>
<p><span class="math display">\[
0 = Var(u'X) = u' Cov(X) u = u' A'A u = (Au)'Au
\]</span></p>
<p>Thus</p>
<p><span class="math display">\[
Au = 0
\]</span></p>
<p>Since <span class="math inline">\(Au\)</span> is a linear combination of the columns of <span class="math inline">\(A\)</span>, we see that the columns of <span class="math inline">\(A\)</span> are linearly dependent.</p>
<p>The same argument works in reverse. If <span class="math inline">\(Au = 0\)</span>, we fine that <span class="math inline">\(Var(u'X)
= 0\)</span>, and since the eigenvalues of <span class="math inline">\(Cov(X)\)</span> are variances of linear combinations of <span class="math inline">\(X\)</span>, we see that one of those variances is 0.</p>
</section>
<section id="sec-backtoafrica" class="level2" data-number="13.3">
<h2 data-number="13.3" class="anchored" data-anchor-id="sec-backtoafrica"><span class="header-section-number">13.3</span> Back to the African Soils Example</h2>
<p>So, we remove the ``Y’’ variable, <strong>pH</strong>, number 3598 as seen above, and proceed. We will also remove the nonnumeric columns, <strong>PIDN</strong> and <strong>Depth</strong>. We could use R’s <strong>prcomp</strong> function here, but to better illustrate the concepts, we do things from scratch.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(WackyData)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(AfricanSoil)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> AfricanSoil[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3595</span>,<span class="dv">3598</span>)]</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1157 3597</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>xcov <span class="ot">&lt;-</span> <span class="fu">cov</span>(x)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>eigs <span class="ot">&lt;-</span> <span class="fu">eigen</span>(xcov)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>eigs<span class="sc">$</span>values[<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>]  <span class="co"># don't print out all 3597!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1] 7.600042e+01 9.553189e+00 6.979629e+00 4.209555e+00 2.884526e+00
  [6] 2.175115e+00 1.954537e+00 1.321853e+00 9.375446e-01 6.453537e-01
 [11] 6.360017e-01 5.484400e-01 4.535480e-01 3.981618e-01 3.665122e-01
 [16] 3.496067e-01 2.597679e-01 2.035621e-01 1.498785e-01 1.248452e-01
 [21] 1.119365e-01 9.545515e-02 8.083867e-02 6.415968e-02 6.079547e-02
 [26] 5.737305e-02 4.468220e-02 3.902647e-02 3.641190e-02 3.056959e-02
 [31] 2.541331e-02 2.037622e-02 1.819728e-02 1.532509e-02 1.297067e-02
 [36] 1.242883e-02 1.073280e-02 9.420125e-03 8.687909e-03 7.980043e-03
 [41] 7.178366e-03 5.445802e-03 4.893268e-03 4.027980e-03 3.903172e-03
 [46] 3.526363e-03 3.341049e-03 3.062258e-03 2.847189e-03 2.723814e-03
 [51] 2.586813e-03 2.315871e-03 2.142482e-03 1.977798e-03 1.771873e-03
 [56] 1.506873e-03 1.474780e-03 1.302539e-03 1.173394e-03 1.141518e-03
 [61] 1.004309e-03 9.438253e-04 8.794233e-04 8.217583e-04 8.137159e-04
 [66] 7.269301e-04 7.187134e-04 6.454513e-04 6.261121e-04 5.256722e-04
 [71] 4.603372e-04 4.256952e-04 4.116083e-04 3.873680e-04 3.802244e-04
 [76] 3.421665e-04 3.144433e-04 3.013745e-04 2.650906e-04 2.561422e-04
 [81] 2.553842e-04 2.436702e-04 2.110897e-04 1.937904e-04 1.851444e-04
 [86] 1.766814e-04 1.569518e-04 1.484314e-04 1.437515e-04 1.263429e-04
 [91] 1.242947e-04 1.154861e-04 1.135908e-04 1.113247e-04 1.003160e-04
 [96] 9.908341e-05 9.180042e-05 8.670191e-05 8.415325e-05 7.907993e-05</code></pre>
</div>
</div>
<p>Ah, the eigenvalues fall off rapidly after the first few. So, let’s say we decide to use the first 9 <span class="math inline">\(u\)</span> vectors.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>eigvecs <span class="ot">&lt;-</span> eigs<span class="sc">$</span>vectors[,<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>]</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(eigvecs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3597    9</code></pre>
</div>
</div>
<p>So, recalling the sequence of equations leading to <a href="Ch6a.html#eq-aha" class="quarto-xref">Equation&nbsp;<span>12.1</span></a>, we are ready to replace our old variables by the new ones, which are linear combinations of the old ones.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(x)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1157 3597</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>xnew <span class="ot">&lt;-</span> x <span class="sc">%*%</span> eigvecs</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(xnew)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1157    9</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>lmout <span class="ot">&lt;-</span> <span class="fu">lm</span>(AfricanSoil<span class="sc">$</span>pH <span class="sc">~</span> xnew)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co"># and so on</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sec-detect" class="level2" data-number="13.4">
<h2 data-number="13.4" class="anchored" data-anchor-id="sec-detect"><span class="header-section-number">13.4</span> PCA in Detection of Multicollinearity</h2>
<p>Recall the itemized list in <a href="Ch5c.html#sec-nearly" class="quarto-xref"><span>Section 11.1</span></a> of various conditions under which we have multicollinearity. We can add the following item to that list:</p>
<ul>
<li><span class="math inline">\(A\)</span> has an eigenvalue that is nearly 0.</li>
</ul>
<p>This follows from what we found about 0 eigenvalues in <a href="#sec-eiglm" class="quarto-xref"><span>Section 13.2</span></a>.<br>
If an eigenvalue is 0, the rank is exactly less than full. If it is approximately 0, the rank is technically full, but there is a linear combination of the variables that is approximately 0.</p>
<p>In fact, PCA can warn us of specific linear combinations of <span class="math inline">\(Cov(A'A)\)</span> that are nearly 0, as follows.</p>
<ul>
<li><p>Say a PC corresponds to a small eigenvalue.</p></li>
<li><p>Then from <a href="Ch6a.html#sec-firstPC" class="quarto-xref"><span>Section 12.2.1</span></a> that linear combination has small variance.</p></li>
<li><p>Random variables with small variance are nearly constant.</p></li>
<li><p>Thus with high probability, the linear combination is near to <span class="math inline">\(c\)</span> for some number <span class="math inline">\(c\)</span>. If we are working with numerical data, that number <span class="math inline">\(c\)</span> is nonzero with high probability (see <a href="#sec-prob0" class="quarto-xref"><span>Section 13.5</span></a>).</p></li>
<li><p>If our design matrix <span class="math inline">\(A\)</span> includes a 1s column, then the above linear combination, together with this 1s column, gives us a linear combination that is usually close to the 0 vector, thus multicollinear.</p></li>
</ul>
<p>In other words, PCA can point out to us specific linear combinations of our variables that may be problematic. If we are considering solving the problem by removing one or more predictor variables, this analysis could suggest which ones to remove.</p>
</section>
<section id="sec-prob0" class="level2" data-number="13.5">
<h2 data-number="13.5" class="anchored" data-anchor-id="sec-prob0"><span class="header-section-number">13.5</span> An Important Property of All-Numeric Predictor Data</h2>
<p>Say we throw a dart at the interval (0,1). If the distribution of the hitting location <span class="math inline">\(D\)</span> is U(0,1) or any other continuous distribution, the probability of hitting a specific point is 0, e.g.&nbsp;<span class="math inline">\(P(D = 0.324) = 0\)</span>. Such is the nature of continuous distributions. The problem is that the length of the line segment (0.324,0.324) is 0. In math, we say it has <em>measure</em> 0.</p>
<p>If we throw our dart at the unit square, <span class="math inline">\((0,1) \times (0,1)\)</span>, then e.g.&nbsp;the probability that <span class="math inline">\(D\)</span> lies on a specified straight line or some other specified curve is also 0. Here the problem is that the area of that line or curve is 0.</p>
<p>This has implications for material in this book. For instance, consider linear regression models. If our <span class="math inline">\(A\)</span> matrix consists of all numeric data, then (in the absence of perfect correlation among the columns), we will have</p>
<p><span class="math display">\[
P(determinant(A'A) = 0) = 0
\]</span></p>
<p>for the same 0-measure reasons. In other words, <span class="math inline">\(A'A\)</span> will be invertible with probability 1.</p>
</section>
<section id="how-many-principal-components-should-we-use" class="level2" data-number="13.6">
<h2 data-number="13.6" class="anchored" data-anchor-id="how-many-principal-components-should-we-use"><span class="header-section-number">13.6</span> How Many Principal Components Should We Use?</h2>
<p>We chose to use the first 9 principal components in our example here, but that was just for illustration purposes. There are no formal rules for how many to use. Various “rules of thumb” exist.</p>
<p>If we are doing prediction, there is a very natural way to choose our number of PCs – do cross-validation (<a href="Ch5c.html#sec-xval" class="quarto-xref"><span>Section 11.6</span></a>), and use whichever number gives the most accurate prediction.</p>
<section id="sec-nyc" class="level3" data-number="13.6.1">
<h3 data-number="13.6.1" class="anchored" data-anchor-id="sec-nyc"><span class="header-section-number">13.6.1</span> Example: New York City taxi trips</h3>
<p>This is a well-known dataset, a version of which is included in the <strong>qeML</strong> package. The object is to predict trip time, given pickup and dropoff locations, trip distance and day of the week.</p>
<p>In the raw form of the data, there are just 5 columns, thus 4 predictors. But the pickup and dropoff locations are R factors, coding numerous locations. These must be decoded to dummy variables (values 1 or 0, coding whether or not, say, a given trip began at pickup location 121). If for instance one calls the R linear regression function <strong>lm</strong>, that function will do the conversion internally, but in our case we will perform the conversion ourselves, using <strong>regtools::factorsToDummies</strong>. (The <strong>regtools</strong> package is included by <strong>qeML</strong>.)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(qeML)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(nyctaxi)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(nyctaxi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 10000     5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>nyc <span class="ot">&lt;-</span> <span class="fu">factorsToDummies</span>(nyctaxi,<span class="at">dfOut=</span>T)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(nyc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 10000   357</code></pre>
</div>
</div>
<p>Wow! That’s quite a lot of predictors, and well in excess of the common rule of thumb that one should have no more than <span class="math inline">\(\sqrt{n}\)</span> predictors, 100 in this case.</p>
<p>So, we might try dimension reduction via PCA, then use the PCs as predictors. The function <strong>qeML::qePCA</strong> combines these two operations. Let’s see how it works.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">args</span>(qePCA)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>function (data, yName, qeName, opts = NULL, pcaProp, holdout = floor(min(1000, 
    0.1 * nrow(data)))) 
NULL</code></pre>
</div>
</div>
<p>Here <strong>qeName</strong> indicates which function is desired for prediction, e.g. <strong>qeLin</strong> for a linear model. (This function wraps <strong>lm</strong>.) But a key argument here is <strong>pcaProp</strong>. Recall that:</p>
<ul>
<li><p>The PCs come in order of decreasing variance.</p></li>
<li><p>We are mainly interested in the first few PCs. The later ones have small variance, which makes them approximately constant and thus of no use to us.</p></li>
</ul>
<p>The name ‘pcaProp’ stands for “proportion of total variance.” If we set this to, say, 0.25, we are saying “Give us whatever number of the first few PCs that have a total variance of at least 25% of the total.” Let’s give that a try:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qePCA</span>(nyc,<span class="st">'tripTime'</span>,<span class="st">'qeLin'</span>,<span class="at">pcaProp=</span><span class="fl">0.25</span>)<span class="sc">$</span>testAcc</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">311.9159</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We asked to predict the column ‘tripTime’ in the dataset <strong>nyc</strong> using the <strong>qeLin</strong> function, based on as many of the PCs that will give us 25% of the total variance. Most <strong>qeML</strong> prediction functions split the data into a training set and a holdout set. The model is fit to the training set, and then applied to prediction of the holdout set. The output value is the mean absolute prediction error (MAPE).</p>
<p>However, since the holdout set is randomly generated, the MAPE value is random, so we should do multiple runs. Some experimentation showed that MAPE here is highly variable, so we decided to perform 500 runs, e.g.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">500</span>,<span class="cf">function</span>(i) <span class="fu">qePCA</span>(nyc,<span class="st">'tripTime'</span>,<span class="st">'qeLin'</span>,<span class="at">pcaProp=</span><span class="fl">0.1</span>)<span class="sc">$</span>testAcc)) </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">359.663</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="caption-top table">
<caption>Mean Absolute Predictive Error</caption>
<thead>
<tr class="header">
<th>pcaProb</th>
<th style="text-align: left;">MAPE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0.1</td>
<td style="text-align: left;">359.6630</td>
</tr>
<tr class="even">
<td>0.2</td>
<td style="text-align: left;">359.3068</td>
</tr>
<tr class="odd">
<td>0.3</td>
<td style="text-align: left;">403.9878</td>
</tr>
<tr class="even">
<td>0.4</td>
<td style="text-align: left;">397.3783</td>
</tr>
<tr class="odd">
<td>0.5</td>
<td style="text-align: left;">430.8958</td>
</tr>
<tr class="even">
<td>0.6</td>
<td style="text-align: left;">423.7299</td>
</tr>
<tr class="odd">
<td>0.7</td>
<td style="text-align: left;">517.7917</td>
</tr>
<tr class="even">
<td>0.8</td>
<td style="text-align: left;">969.1304</td>
</tr>
<tr class="odd">
<td>0.9</td>
<td style="text-align: left;">2275.091</td>
</tr>
</tbody>
</table>
<p>Among other things, this shows the dangers of overfitting, in this case using too many PCs in our linear regression model. It seems best here to use only the first 10 or 20% of the PCs.</p>
</section>
</section>
<section id="sec-squareroot" class="level2" data-number="13.7">
<h2 data-number="13.7" class="anchored" data-anchor-id="sec-squareroot"><span class="header-section-number">13.7</span> A “Square Root” Matrix, and MV Normal Simulation</h2>
<div id="thm-sqrt" class="theorem">
<p><span class="theorem-title"><strong>Theorem 13.2</strong></span> Any covariance matrix <span class="math inline">\(A\)</span> has a “square root” matrix <span class="math inline">\(Q\)</span>, i.e. <span class="math display">\[
Q^2 = A
\]</span></p>
</div>
<div class="proof">
<p><span class="proof-title"><em>Proof</em>. </span>From <a href="#thm-thestory" class="quarto-xref">Theorem&nbsp;<span>13.1</span></a>, we have <span class="math inline">\(P' A P = D\)</span> for some matrix <span class="math inline">\(P\)</span> and diagonal matrix <span class="math inline">\(D\)</span>, with the entries of the latter being the variances of the PCs <span class="math inline">\(\sigma_i^2\)</span>. That latter point implies that</p>
<p><span class="math display">\[
D_1^2 = D
\]</span></p>
<p>where <span class="math inline">\(D_1 = diag(\sigma_1,\sigma_2,...,\sigma_n)\)</span>. Then setting <span class="math inline">\(Q = P D_1 P'\)</span>, we have</p>
<p><span class="math display">\[
Q^2 = (P D_1 P') (P D_1 P') = P D_1^2 P' = P D P' = A
\]</span></p>
<section id="implications-for-simulation-of-multivariate-normal-x" class="level3" data-number="13.7.1">
<h3 data-number="13.7.1" class="anchored" data-anchor-id="implications-for-simulation-of-multivariate-normal-x"><span class="header-section-number">13.7.1</span> Implications for simulation of multivariate normal X</h3>
<p>Say we wish to write code to simulate a random vector <span class="math inline">\(Q\)</span> having an m-variate normal distribution with mean vector <span class="math inline">\(\mu\)</span> and covariance matrix <span class="math inline">\(\Sigma\)</span>. Here is how it works:</p>
<ul>
<li><p>We start with generating <span class="math inline">\(Z\)</span>, a vector o <span class="math inline">\(m\)</span> independent N(0,1) variables. That means <span class="math inline">\(Z\)</span> is m-variate normally distributed, with mean vector consisting of <span class="math inline">\(m\)</span> 0s, and covariance matrix <span class="math inline">\(I\)</span>, the <span class="math inline">\(m \times m\)</span> identity matrix.</p></li>
<li><p>We compute <span class="math inline">\(W = \Sigma^{0.5} Z\)</span>. By <a href="Ch2a.html#eq-covax" class="quarto-xref">Equation&nbsp;<span>4.8</span></a>, <span class="math inline">\(W\)</span> will again be multivariate normally distributed, with mean vector consisting of <span class="math inline">\(m\)</span> 0s, and covariance matrix equal to</p>
<p><span class="math display">\[
\Sigma^{0.5} I \Sigma^{0.5} = \Sigma
\]</span></p>
<p>Our solution is then</p>
<p><span class="math display">\[
Q = \mu + \Sigma^{0.5} Z
\]</span></p></li>
</ul>
<p><span class="math inline">\(\square\)</span></p>
</section>
</div>
</section>
<section id="your-turn" class="level2" data-number="13.8">
<h2 data-number="13.8" class="anchored" data-anchor-id="your-turn"><span class="header-section-number">13.8</span> Your Turn</h2>
<p>❄️ <strong>Your Turn:</strong> Use PCA to do dimension reduction on the <strong>s50</strong> dataset.</p>
<p>❄️ <strong>Your Turn:</strong> The reader has likely seen the concept of a <em>cumulative distribution function</em> (CDF). For a scalar random variable <span class="math inline">\(X\)</span>, this is <span class="math inline">\(F_x(t) = P(X \leq t)\)</span>. If <span class="math inline">\(X\)</span> is an <span class="math inline">\(m\)</span>-dimensional random vector, the definition is</p>
<p><span class="math display">\[
F_X(t_1,...,t_m) = P(X_1 \leq t_1,...,X_m \leq t_m)
\]</span></p>
<p>Write an R function with call form</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">multiCDF</span>(mu,Sigma,t,n)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>that uses simulation to evaluate the multivariate CDF, where <span class="math inline">\(t =
(t_1,...,t_m)\)</span> and <span class="math inline">\(n\)</span> is the number of replications to simulate.</p>
<p>❄️ <strong>Your Turn:</strong> Say <span class="math inline">\(X\)</span> has mean vector <span class="math inline">\(\mu\)</span> and covariance matrix <span class="math inline">\(\Sigma\)</span>. Show how we can use <a href="#thm-sqrt" class="quarto-xref">Theorem&nbsp;<span>13.2</span></a> to find a square, constant matrix <span class="math inline">\(A\)</span> such that <span class="math inline">\(Cov(AX) = I\)</span>. If in addition <span class="math inline">\(X\)</span> has a multivariate normal distribution, then <span class="math inline">\(AX\)</span> will then consist of independent random variables with variance 1. Explain why.</p>
<p>❄️ <strong>Your Turn:</strong> Modify the code for <strong>qePCA</strong> for the case of linear regression by adding a component <strong>xCoeffs</strong> to its return value. This will give the regression coefficients in terms of the original X predictors.</p>
<p>❄️ <strong>Your Turn:</strong> Say the symmetric matrix <span class="math inline">\(A\)</span> has <em>block diagonal</em> form</p>
<p><span class="math display">\[
A =
\left (
\begin{array}{rrr}
A_1 &amp; 0 &amp; 0 ... \\
0 &amp; A_2 &amp; 0 ...  \\
...
\end{array}
\right )
\]</span></p>
<p>where <span class="math inline">\(A_i\)</span> (<span class="math inline">\(i=1,...,r)\)</span></p>
<ul>
<li><p>is symmetric</p></li>
<li><p>is of size <span class="math inline">\(k_i \times k_i\)</span></p></li>
<li><p>has eigenvalues <span class="math inline">\(\gamma_{1},...,\gamma_{k_i}\)</span></p></li>
<li><p>has eigenvectors <span class="math inline">\(u_{1,j},...,u_{k,j}\)</span>, where <span class="math inline">\(j=1,...,k_i\)</span></p></li>
</ul>
<p>State the form of the eigenvalues and eigenvectors of <span class="math inline">\(A\)</span>.</p>
<p>❄️ <strong>Your Turn:</strong> In <a href="#sec-detect" class="quarto-xref"><span>Section 13.4</span></a>, there was a statement “<span class="math inline">\(c\)</span> is nonzero with high probability.” Why was that important?</p>
<p>❄️ <strong>Your Turn:</strong> Write an R function with call form</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bestPCAPred</span>(data,yName)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>It will apply PCA to the X portion of <strong>data</strong>, then apply <strong>lm</strong> successivly to the first PC, then the first two, then the first three and so on assessing with cross-validation in each case. It will then return the number of PCs (and the PCs themselves) that predicts best. Try your function on various datasets.</p>
<p>❄️ <strong>Your Turn:</strong> Say the symmetric <span class="math inline">\(n \times n\)</span> matrix <span class="math inline">\(A\)</span> has rank <span class="math inline">\(r\)</span>. Show that <span class="math inline">\(n-r\)</span> of its eigenvalues are 0s.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./Ch6a.html" class="pagination-link" aria-label="Eigenanalysis">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Eigenanalysis</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./Ch6c.html" class="pagination-link" aria-label="Singular Value Decomposition">
        <span class="nav-page-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Singular Value Decomposition</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>