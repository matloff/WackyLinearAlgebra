<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>14&nbsp; A Deeper Look at Overfitting – Powered by Linear Algebra</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./Ch8a.html" rel="next">
<link href="./Ch6c.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-5e2915e4d4df5928b2b0a61215b328b6.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Ch6d.html"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">A Deeper Look at Overfitting</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Powered by Linear Algebra</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">index.html</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Matrices and Vectors</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Matrix Inverse</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch2a.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Covariance Matrices, MV Normal Distribution, Delta Method</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Linear Statistical Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Matrix Rank</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch5a.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Vector Spaces</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch5b.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Inner Product Spaces</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch5bb.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Four Fundamental Spaces</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch5c.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Shrinkage Estimators</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch6a.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Eigenanalysis</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch6b.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Principal Components</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch6c.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Singular Value Decomposition</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch6d.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">A Deeper Look at Overfitting</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch8a.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Selected Issues in Machine Learning</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contents</h2>
   
  <ul>
  <li><a href="#motivating-example" id="toc-motivating-example" class="nav-link active" data-scroll-target="#motivating-example"><span class="header-section-number">14.1</span> Motivating Example</a></li>
  <li><a href="#interpolation-point" id="toc-interpolation-point" class="nav-link" data-scroll-target="#interpolation-point"><span class="header-section-number">14.2</span> Interpolation Point</a></li>
  <li><a href="#double-descent" id="toc-double-descent" class="nav-link" data-scroll-target="#double-descent"><span class="header-section-number">14.3</span> Double Descent</a></li>
  <li><a href="#plausibility-of-double-descent-the-minimum-norm-solutions" id="toc-plausibility-of-double-descent-the-minimum-norm-solutions" class="nav-link" data-scroll-target="#plausibility-of-double-descent-the-minimum-norm-solutions"><span class="header-section-number">14.4</span> Plausibility of Double Descent: the Minimum Norm Solutions</a>
  <ul class="collapse">
  <li><a href="#proof-of-the-minimum-norm-property" id="toc-proof-of-the-minimum-norm-property" class="nav-link" data-scroll-target="#proof-of-the-minimum-norm-property"><span class="header-section-number">14.4.1</span> Proof of the minimum-norm property</a></li>
  <li><a href="#connection-to-double-descent" id="toc-connection-to-double-descent" class="nav-link" data-scroll-target="#connection-to-double-descent"><span class="header-section-number">14.4.2</span> Connection to Double Descent</a></li>
  </ul></li>
  <li><a href="#plausibility-of-double-descent-the-condition-number" id="toc-plausibility-of-double-descent-the-condition-number" class="nav-link" data-scroll-target="#plausibility-of-double-descent-the-condition-number"><span class="header-section-number">14.5</span> Plausibility of Double Descent: the Condition Number</a></li>
  <li><a href="#your-turn" id="toc-your-turn" class="nav-link" data-scroll-target="#your-turn"><span class="header-section-number">14.6</span> Your Turn</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-chapDD" class="quarto-section-identifier"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">A Deeper Look at Overfitting</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div style="page-break-after: always;"></div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Goals of this chapter:
</div>
</div>
<div class="callout-body-container callout-body">
<p>We have mentioned the concept of “overfitting” occasionally in previous chapters. It has always been an issue in statistics, but in recent years it has become an acute problem as datasets with very large number of predictors <span class="math inline">\(p\)</span>, and old assumptions are now being questioned. This chapter presents an up-to-date view of the topic, and as usual, linear algebra plays a key role.</p>
</div>
</div>
<section id="motivating-example" class="level2" data-number="14.1">
<h2 data-number="14.1" class="anchored" data-anchor-id="motivating-example"><span class="header-section-number">14.1</span> Motivating Example</h2>
<p>Classically, statistics and ML books have stated that, for fixed number of data points <span class="math inline">\(n\)</span>, the graph of predictive accuracy against number of predictor variables <span class="math inline">\(p\)</span> roughly has a U-shape, concave up. Starting at <span class="math inline">\(p = 1\)</span> and then increasing <span class="math inline">\(p\)</span>, we achieve better and better predictive power until we reach the minimum point of the U; adding further predictors degrades performance.</p>
<p>We wish to explore this notion on the Million Song dataset from <span class="quarto-unresolved-ref">?sec-millonsong</span>. Here “Y” is the year of release of a song, stored in the first column with label <strong>V1</strong>. “X” is a set of 90 audio measurements. In the version of the dataset used here, we have 5000 rows.</p>
<p>We ran code like this:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(<span class="fu">seq</span>(<span class="dv">10</span>,<span class="dv">90</span>,<span class="dv">10</span>),<span class="cf">function</span>(p)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mean</span>(<span class="fu">replicate</span>(<span class="dv">500</span>,</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>   qeML<span class="sc">::</span><span class="fu">qeLin</span>(yr5000[<span class="dv">1</span><span class="sc">:</span><span class="dv">150</span>,<span class="dv">1</span><span class="sc">:</span>p],<span class="st">'V1'</span>)<span class="sc">$</span>testAcc</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>   )))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Here we are running a linear model on the first 150 rows of the dataset (i.e.&nbsp;<span class="math inline">\(n=150\)</span>), and the first <span class="math inline">\(p\)</span> columns, so that <span class="math inline">\(p = 10,20,...,90\)</span>. Since the <span class="math inline">\(qeML\)</span> functions automatically form holdout sets, we obtain the accuracy value, Mean Absolute Prediction Error. And since the holdout set is randomly chosen, we do this 500 times. We graph the result using <strong>qePlotCurves</strong> (which does smoothing).</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Ushapes.png" class="img-fluid figure-img"></p>
<figcaption>U shapes</figcaption>
</figure>
</div>
<p>What do we see here?</p>
<ul>
<li><p>The graphs are indeed U-shaped, albeit often shallower than the typical pictures shown in books.</p></li>
<li><p>The larger the value of <span class="math inline">\(n\)</span>,</p>
<ul>
<li><p>the lower the curve (better prediction accuracy), and</p></li>
<li><p>the larger the value of the best <span class="math inline">\(p\)</span> (optimal to use more predictors)</p></li>
</ul></li>
<li><p>Some are half-U’s, indicating it’s best to use all variables (large <span class="math inline">\(n\)</span>) or one or two (small <span class="math inline">\(n\)</span>).</p></li>
</ul>
</section>
<section id="interpolation-point" class="level2" data-number="14.2">
<h2 data-number="14.2" class="anchored" data-anchor-id="interpolation-point"><span class="header-section-number">14.2</span> Interpolation Point</h2>
<p>Consider a linear regression model, for convenience say with no <span class="math inline">\(\beta_0\)</span> term. As <span class="math inline">\(p\)</span> increases, eventually it becomes equal to <span class="math inline">\(n\)</span>, the number of rows. When that happens, we get a “perfect” fit: Our line, plane or hyperplane will pass through every data point, and <a href="Ch3.html#eq-matrixss" class="quarto-xref">Equation&nbsp;<span>5.3</span></a> will be 0. Just think of the case <span class="math inline">\(p=1\)</span>, now with a <span class="math inline">\(\beta_0\)</span> term: Two points in <span class="math inline">\(\cal{R}^2\)</span>, through which we can draw a line passing through them.</p>
<p>This value of <span class="math inline">\(p\)</span> is thus called the <em>interpolation point</em>, viewed classically as follows.</p>
<ul>
<li><p>Of course, setting <span class="math inline">\(p\)</span> to be the interpolation point would will be a terrible fit, unable to predict new data well; we are at the right-hand end of the U.</p></li>
<li><p>And since we already have reached a “perfect” fit, there would be no point in increasing <span class="math inline">\(p\)</span> any further (using a pseudoinverse).</p></li>
</ul>
<p>So, pictures of overfititng in books had <span class="math inline">\(p\)</span> stop at <span class="math inline">\(n\)</span>. But wow, were they wrong!</p>
</section>
<section id="double-descent" class="level2" data-number="14.3">
<h2 data-number="14.3" class="anchored" data-anchor-id="double-descent"><span class="header-section-number">14.3</span> Double Descent</h2>
<p>Though the prevailing wisdom used to be that, as noted above, there is no point in trying values of <span class="math inline">\(p\)</span> even near <span class="math inline">\(n\)</span>, let alone beyond <span class="math inline">\(n\)</span>. It turns out that in some cases, the best value of <span class="math inline">\(p\)</span> is in fact larger than <span class="math inline">\(n\)</span></p>
<p>As a first step to seeing this, consider the following code:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>overfit <span class="ot">&lt;-</span> <span class="cf">function</span>(nreps,n,maxP)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>{  </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">require</span>(qeML)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">load</span>(<span class="st">'YearData.save'</span>)  <span class="co"># 500K Million Song data</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>   nas <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>,nreps<span class="sc">*</span>(maxP<span class="dv">-1</span>))</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>   <span class="co"># record p, Mean Absolute Prediction Error</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>   outdf <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">p=</span>nas,<span class="at">mape=</span>nas)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>   rownum <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nreps) {</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>      idxs <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(yr),n)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>      trn <span class="ot">&lt;-</span> yr[idxs,] </span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>      tst <span class="ot">&lt;-</span> yr[<span class="sc">-</span>idxs,]           </span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (p <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>maxP) {</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>         rownum <span class="ot">&lt;-</span> rownum <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>         out<span class="ot">&lt;-</span><span class="fu">qePolyLin</span>(trn[,<span class="dv">1</span><span class="sc">:</span>(p<span class="sc">+</span><span class="dv">1</span>)],</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>            <span class="st">'V1'</span>,<span class="dv">2</span>,<span class="at">holdout=</span><span class="cn">NULL</span>) </span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>         preds <span class="ot">&lt;-</span> <span class="fu">predict</span>(out,tst[,<span class="sc">-</span><span class="dv">1</span>]) </span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>         mape <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">abs</span>(preds <span class="sc">-</span> tst[,<span class="dv">1</span>])) </span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>         outdf[rownum,<span class="dv">1</span>] <span class="ot">&lt;-</span> p</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>         outdf[rownum,<span class="dv">2</span>] <span class="ot">&lt;-</span> mape</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>         <span class="fu">print</span>(outdf[rownum,])</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>   }</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>   outdf  </span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">overfit</span>(<span class="dv">10</span>,<span class="dv">250</span>,<span class="dv">30</span>)</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>w <span class="ot">&lt;-</span> <span class="fu">tapply</span>(z<span class="sc">$</span>mape,z<span class="sc">$</span>p,mean)</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(w)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This code tries values of <strong>p</strong> up to <strong>maxP</strong> but one must note that we are fitting quadratic models. For any given value of <strong>p</strong>, the number of columns after polynomial expansion will be much larger. Consider this code:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> u22 <span class="ot">&lt;-</span> <span class="fu">qePolyLin</span>(yr[<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">23</span>],<span class="st">'V1'</span>,<span class="at">deg=</span><span class="dv">2</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>P <span class="sc">&gt;</span> N. With polynomial terms and interactions, P is <span class="fl">265.</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> u22 <span class="ot">&lt;-</span> <span class="fu">qePolyLin</span>(yr[<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">22</span>],<span class="st">'V1'</span>,<span class="at">deg=</span><span class="dv">2</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>P <span class="sc">&gt;</span> N. With polynomial terms and interactions, P is <span class="fl">246.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>So <span class="math inline">\(p = 21\)</span> will upon polynomial expansion produce 246 columns, while <span class="math inline">\(p=22\)</span> will produce 265. We won’t hit 250 exactly, but the interpolation point will be in this range.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="PolyDoubleDesc.png" class="img-fluid figure-img"></p>
<figcaption>U shapes</figcaption>
</figure>
</div>
<p>After the interpolation point, we see another U! Hence the name <em>double descent</em>. This introduces the concept, but the big news is:</p>
<blockquote class="blockquote">
<p>The minimum of the second U is sometimes lower than that of the first. In other words, it can pay to overfit!</p>
</blockquote>
<p>We’ll see examples shortly, but first let’s see how linear algebra plays a role.</p>
</section>
<section id="plausibility-of-double-descent-the-minimum-norm-solutions" class="level2 page-columns page-full" data-number="14.4">
<h2 data-number="14.4" class="anchored" data-anchor-id="plausibility-of-double-descent-the-minimum-norm-solutions"><span class="header-section-number">14.4</span> Plausibility of Double Descent: the Minimum Norm Solutions</h2>
<p>In an overdetermined linear system such as <a href="Ch6c.html#eq-overdetermined" class="quarto-xref">Equation&nbsp;<span>13.5</span></a>, there are many solutions. Our <strong>qePolyLin</strong> function calls <strong>regtools::penrosePoly</strong>. An advantage of Moore-Penrose is that it gives us the <em>minimum norm</em> solution. We’ll discuss the significance of this for Double Descent shortly, but let’s prove it first.</p>
<section id="proof-of-the-minimum-norm-property" class="level3 page-columns page-full" data-number="14.4.1">
<h3 data-number="14.4.1" class="anchored" data-anchor-id="proof-of-the-minimum-norm-property"><span class="header-section-number">14.4.1</span> Proof of the minimum-norm property</h3>
<p>We will need this:</p>
<div id="thm-samenorm" class="theorem">
<p><span class="theorem-title"><strong>Theorem 14.1 (Multiplication by an Orthogonal Matrix Preserves Norm)</strong></span> For an orthogonal matrix <span class="math inline">\(M\)</span> and a vector <span class="math inline">\(w\)</span>, <span class="math inline">\(||Mw|| = ||w||\)</span>.</p>
</div>
<div class="proof">
<p><span class="proof-title"><em>Proof</em>. </span>See the Your Turn problem below.</p>
</div>
<div id="thm-shortest" class="theorem">
<p><span class="theorem-title"><strong>Theorem 14.2 (The Moore-Penrose Solution Is Min-Norm)</strong></span> Consider an <span class="math inline">\(m \times n\)</span> matrix <span class="math inline">\(B\)</span> and vector <span class="math inline">\(q\)</span> of length <span class="math inline">\(m\)</span>. Of all solutions <span class="math inline">\(x\)</span> (of length <span class="math inline">\(n\)</span>) to</p>
<p><span id="eq-linsyst"><span class="math display">\[
Bx = q
\tag{14.1}\]</span></span></p>
<p>the Moore-Penrose solution minimizes <span class="math inline">\(||x||\)</span>.</p>
</div>
<div class="proof page-columns page-full">
<div class="page-columns page-full"><p><span class="proof-title"><em>Proof</em>. </span>Again, write</p><div class="no-row-height column-margin column-container"><span class="">Adapted in part from a derivation by Jose’ C. Feriero.</span></div></div>
<p><span class="math display">\[
B = U \Sigma V',
\]</span></p>
<p>where <span class="math inline">\(U\)</span> is <span class="math inline">\(m \times n\)</span> and <span class="math inline">\(\Sigma\)</span> and <span class="math inline">\(V\)</span> are <span class="math inline">\(n \times n\)</span>. (For our discussion of overfitting, we will primarily be interested in the case <span class="math inline">\(n &gt; m\)</span>.)</p>
<p>Consider the residual sum of squares</p>
<p><span id="eq-RSS"><span class="math display">\[
||Bx - q||^2 = ||U \Sigma V' x -q||^2
\tag{14.2}\]</span></span></p>
<p>so</p>
<p><span id="eq-RSS1"><span class="math display">\[
||Bx - q||^2 = ||U (\Sigma V' x - U'q)||^2
\tag{14.3}\]</span></span></p>
<p>since <span class="math inline">\(UU'=I\)</span>.</p>
<p>From <a href="#thm-samenorm" class="quarto-xref">Theorem&nbsp;<span>14.1</span></a> we can remove the factor <span class="math inline">\(U\)</span> in <a href="#eq-RSS1" class="quarto-xref">Equation&nbsp;<span>14.3</span></a>, yielding</p>
<p><span id="eq-RSS2"><span class="math display">\[
||Bx - q||^2 = ||\Sigma V' x - U'q||^2
\tag{14.4}\]</span></span></p>
<p>Rename <span class="math inline">\(V'x\)</span> to <span class="math inline">\(w\)</span> and <span class="math inline">\(U'q\)</span> to <span class="math inline">\(s\)</span> (a constant vector):</p>
<p><span id="eq-RSS3"><span class="math display">\[
||Bx - q||^2 = ||\Sigma w - s||^2
\tag{14.5}\]</span></span></p>
<p>So, instead of finding <span class="math inline">\(x\)</span> to minimize the residual sum of squares <span class="math inline">\(||Bx - q||^2\)</span>, we’ve (temporarily) changed the problem to that of finding <span class="math inline">\(w\)</span> to minimmize</p>
<p><span id="eq-newResids"><span class="math display">\[
||\Sigma w - s||^2
\tag{14.6}\]</span></span></p>
<div class="page-columns page-full"><p>Now bring in the fact that <span class="math inline">\(\sigma_i = 0\)</span> for <span class="math inline">\(i &gt; r\)</span>, with <span class="math inline">\(r\)</span> being the rank of <span class="math inline">\(B\)</span>. That has the interesting implication that <span class="math inline">\(w_{r+1},....,w_n\)</span> can be anything whatsoever, in <a href="#eq-newResids" class="quarto-xref">Equation&nbsp;<span>14.6</span></a> – the value of that expression is completely independent of <span class="math inline">\(w_{r+1},....,w_n\)</span>. So that shows that if <span class="math inline">\(r &lt; n\)</span>, there are infinitely many solutions <span class="math inline">\(w\)</span>, and thus infinitely many solutions to <span class="math inline">\(Bx = q\)</span>, since <span class="math inline">\(x = Vw\)</span>. </p><div class="no-row-height column-margin column-container"><span class="">Note that we are also making use of the fact that <span class="math inline">\(V\)</span> is invertible (<span class="math inline">\(VV'=I\)</span>).</span></div></div>
<p>Recall that our goal is to find the minimum-norm value of <span class="math inline">\(x\)</span>, and since <span class="math inline">\(||x|| = ||w||\)</span> (<a href="#thm-samenorm" class="quarto-xref">Theorem&nbsp;<span>14.1</span></a>), our problem is thus reduced to finding the minimum-norm <span class="math inline">\(w\)</span>.</p>
<p>Now since</p>
<p><span class="math display">\[
||w||^2 = w_1^2+...+w_r^2+w_{r+1}^2+...+w_n^2
\]</span></p>
<p>and since we have a free hand in choosing <span class="math inline">\(w_{r+1},...,w_n\)</span>, we minimize <span class="math inline">\(||w||\)</span> by setting those <span class="math inline">\(n-r\)</span> values to 0.</p>
<p>Thus we can make <a href="#eq-newResids" class="quarto-xref">Equation&nbsp;<span>14.6</span></a> equal to 0, i.e.&nbsp;exact fit, by setting</p>
<p><span class="math display">\[
w = \Sigma^{+} s
\]</span></p>
<p>where <span class="math inline">\(\Sigma^{+}\)</span> is the diagonal matrix with elements <span class="math inline">\(\sigma_1^{-1},...,\sigma_r^{-1},0,....,0\)</span>.</p>
<p>Wrapping up, we have</p>
<p><span class="math display">\[
x = Vw = V \Sigma^{+} U' q
\]</span></p>
<p>Exactly the Moore-Penrose inverse!</p>
<p><span class="math inline">\(\square\)</span></p>
</div>
</section>
<section id="connection-to-double-descent" class="level3" data-number="14.4.2">
<h3 data-number="14.4.2" class="anchored" data-anchor-id="connection-to-double-descent"><span class="header-section-number">14.4.2</span> Connection to Double Descent</h3>
<p>First, consider the minimum norm solution <span class="math inline">\(x_{min}\)</span> in our last section, with <span class="math inline">\(p &gt; n\)</span>, i.e.&nbsp;post-interpolation.$ Intuitively, shorter solutions have less variability, i.e.&nbsp;smaller variance. Moreover, all the solutions have a 0 residual sum of squares. It is thus plausible that <span class="math inline">\(x_{min}\)</span> might do better than the value of <span class="math inline">\(x\)</span> we obtain at interpolation, hence a downward trend in the curve of predictive accuracy against <span class="math inline">\(p\)</span>. On the other hand, as <span class="math inline">\(p\)</span> grows further, <span class="math inline">\(x\)</span> has more and more components, and likely that minmum-norm <span class="math inline">\(x\)</span> will grow in length at some point, hence the typical U-shope – as our <em>second</em> U.</p>
<p>In addition, if <em>gradient descent</em> is used to minimize the least-squares problem, the tendency is that the result will be of minimum norm.</p>
</section>
</section>
<section id="plausibility-of-double-descent-the-condition-number" class="level2 page-columns page-full" data-number="14.5">
<h2 data-number="14.5" class="anchored" data-anchor-id="plausibility-of-double-descent-the-condition-number"><span class="header-section-number">14.5</span> Plausibility of Double Descent: the Condition Number</h2>
<p>We briefly mentioned the <em>condition number</em> of a square matrix <span class="math inline">\(A\)</span> back in <a href="Ch6a.html#sec-detecting" class="quarto-xref"><span>Section 11.7</span></a>, the ratio of the maximal and minimal eigenvalues. High values suggest problems of multicollinarity</p>
<div class="page-columns page-full"><p>If <span class="math inline">\(A\)</span> is nonsquare, as in our setting in this chapter, one can apply the same criterion to <span class="math inline">\(AA'\)</span>. Then we can go through the same exercise as above, starting with <span class="math inline">\(p=1\)</span>, i.e.&nbsp;using only the first column of <span class="math inline">\(A\)</span>, then adding more and more columns. It turns out that if we graph condition number agains <span class="math inline">\(p\)</span>, we again see Double Descent behavior! And again, the peak will occur at the interpolation point.</p><div class="no-row-height column-margin column-container"><span class="">As before, once <span class="math inline">\(p\)</span> passes the interpolation point, we need to use the pseudoinverse or equivalent. Also, now the denominator will be the smallest <em>nonzero</em> eigenvalue</span></div></div>
<p>Here is the code, run on the Million Song data:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>cn <span class="ot">&lt;-</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="cf">function</span>(a) </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>   aap <span class="ot">&lt;-</span> a <span class="sc">%*%</span> <span class="fu">t</span>(a)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>   evs <span class="ot">&lt;-</span> <span class="fu">eigen</span>(aap)<span class="sc">$</span>values</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>   <span class="fu">max</span>(evs) <span class="sc">/</span> <span class="fu">min</span>(evs[evs <span class="sc">&gt;</span> <span class="fl">1.0e-02</span>])</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>u <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">55</span>,<span class="dv">85</span>,<span class="dv">1</span>) </span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">sapply</span>(u,<span class="cf">function</span>(p) <span class="fu">cn</span>(yr[<span class="dv">1</span><span class="sc">:</span><span class="dv">75</span>,<span class="dv">1</span><span class="sc">:</span>p]))</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(u,z,<span class="at">cex=</span><span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="CondNumDoubleDescent.png" class="img-fluid figure-img"></p>
<figcaption>Condition number</figcaption>
</figure>
</div>
<p>There it is, a peak at <span class="math inline">\(n=p\)</span>.</p>
<p>Now, how might this relate to the original (accuracy vs.&nbsp;<span class="math inline">\(p\)</span> Double Descent problemm? Recall that a large condition number indicates multicollinarity, which in turn causes high variance in <span class="math inline">\(\widehat{\beta}\)</span>, thus impaired predictive ability.</p>
</section>
<section id="your-turn" class="level2" data-number="14.6">
<h2 data-number="14.6" class="anchored" data-anchor-id="your-turn"><span class="header-section-number">14.6</span> Your Turn</h2>
<p>❄️ <strong>Your Turn:</strong> Show that for an orthogonal matrix <span class="math inline">\(M\)</span> and a vector <span class="math inline">\(w\)</span>, <span class="math inline">\(||Mw|| = ||w||\)</span>.</p>
<p>❄️ <strong>Your Turn:</strong> Using properties of matrix rank, show that if <span class="math inline">\(p+1 &gt; n\)</span> in <a href="Ch3.html#eq-betahat" class="quarto-xref">Equation&nbsp;<span>5.8</span></a>, the inverse will not exist.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./Ch6c.html" class="pagination-link" aria-label="Singular Value Decomposition">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Singular Value Decomposition</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./Ch8a.html" class="pagination-link" aria-label="Selected Issues in Machine Learning">
        <span class="nav-page-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Selected Issues in Machine Learning</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>