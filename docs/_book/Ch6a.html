<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Powered by Linear Algebra - 10&nbsp; Eigenanalysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./Ch6b.html" rel="next">
<link href="./Ch5c.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Ch6a.html"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Eigenanalysis</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Powered by Linear Algebra</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">index.html</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Matrices and Vectors</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Matrix Inverse</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch2a.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Covariance Matrices, MV Normal Distribution, Delta Method</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Linear Statistical Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Matrix Rank</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch5a.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Vector Spaces</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch5b.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Inner Product Spaces</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch5c.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Shrinkage Estimators</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch6a.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Eigenanalysis</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch6b.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Principal Components</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch6c.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Singular Value Decomposition</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch6d.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Pseudoinverse and Double Descent</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch7a.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Recommender Systems</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch8a.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Neural Networks</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#example-african-soils-data" id="toc-example-african-soils-data" class="nav-link active" data-scroll-target="#example-african-soils-data"><span class="header-section-number">10.1</span> Example: African Soils Data</a></li>
  <li><a href="#overall-idea" id="toc-overall-idea" class="nav-link" data-scroll-target="#overall-idea"><span class="header-section-number">10.2</span> Overall Idea</a>
  <ul class="collapse">
  <li><a href="#sec-firstPC" id="toc-sec-firstPC" class="nav-link" data-scroll-target="#sec-firstPC"><span class="header-section-number">10.2.1</span> The first PC</a></li>
  </ul></li>
  <li><a href="#definition" id="toc-definition" class="nav-link" data-scroll-target="#definition"><span class="header-section-number">10.3</span> Definition</a></li>
  <li><a href="#a-first-look" id="toc-a-first-look" class="nav-link" data-scroll-target="#a-first-look"><span class="header-section-number">10.4</span> A First Look</a></li>
  <li><a href="#the-special-case-of-symmetric-matrices" id="toc-the-special-case-of-symmetric-matrices" class="nav-link" data-scroll-target="#the-special-case-of-symmetric-matrices"><span class="header-section-number">10.5</span> The Special Case of Symmetric Matrices</a>
  <ul class="collapse">
  <li><a href="#eigenvalues-are-real" id="toc-eigenvalues-are-real" class="nav-link" data-scroll-target="#eigenvalues-are-real"><span class="header-section-number">10.5.1</span> Eigenvalues are real</a></li>
  <li><a href="#sec-eigortho" id="toc-sec-eigortho" class="nav-link" data-scroll-target="#sec-eigortho"><span class="header-section-number">10.5.2</span> Eigenvectors are orthogonal</a></li>
  <li><a href="#sec-diagonalizable" id="toc-sec-diagonalizable" class="nav-link" data-scroll-target="#sec-diagonalizable"><span class="header-section-number">10.5.3</span> Symmetric matrices are diagonalizable</a></li>
  <li><a href="#example-census-dataset" id="toc-example-census-dataset" class="nav-link" data-scroll-target="#example-census-dataset"><span class="header-section-number">10.5.4</span> Example: Census dataset</a></li>
  </ul></li>
  <li><a href="#application-detecting-multicollinearity" id="toc-application-detecting-multicollinearity" class="nav-link" data-scroll-target="#application-detecting-multicollinearity"><span class="header-section-number">10.6</span> Application: Detecting Multicollinearity</a></li>
  <li><a href="#example-currency-data" id="toc-example-currency-data" class="nav-link" data-scroll-target="#example-currency-data"><span class="header-section-number">10.7</span> Example: Currency Data</a></li>
  <li><a href="#computation-the-power-method" id="toc-computation-the-power-method" class="nav-link" data-scroll-target="#computation-the-power-method"><span class="header-section-number">10.8</span> Computation: the Power Method</a></li>
  <li><a href="#application-computation-of-long-run-distribution-in-markov-chains" id="toc-application-computation-of-long-run-distribution-in-markov-chains" class="nav-link" data-scroll-target="#application-computation-of-long-run-distribution-in-markov-chains"><span class="header-section-number">10.9</span> Application: Computation of Long-Run Distribution in Markov Chains</a></li>
  <li><a href="#your-turn" id="toc-your-turn" class="nav-link" data-scroll-target="#your-turn"><span class="header-section-number">10.10</span> Your Turn</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Eigenanalysis</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div style="page-break-after: always;"></div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Goals of this chapter:
</div>
</div>
<div class="callout-body-container callout-body">
<p>The concept of eigenvalues and eigenvectors is one of the most important of all appplications of linear algebra to data science. We introduce the basic ideas and properties in this chapter.</p>
</div>
</div>
<section id="example-african-soils-data" class="level2" data-number="10.1">
<h2 data-number="10.1" class="anchored" data-anchor-id="example-african-soils-data"><span class="header-section-number">10.1</span> Example: African Soils Data</h2>
<p>To get things started, let’s consider the African Soils dataset.</p>
<p>Let’s take a look around:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(WackyData) </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(AfricanSoil)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(AfricanSoil)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1157 3600</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(AfricanSoil)[<span class="dv">1</span><span class="sc">:</span><span class="dv">25</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "PIDN"     "m7497.96" "m7496.04" "m7494.11" "m7492.18" "m7490.25"
 [7] "m7488.32" "m7486.39" "m7484.46" "m7482.54" "m7480.61" "m7478.68"
[13] "m7476.75" "m7474.82" "m7472.89" "m7470.97" "m7469.04" "m7467.11"
[19] "m7465.18" "m7463.25" "m7461.32" "m7459.39" "m7457.47" "m7455.54"
[25] "m7453.61"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(AfricanSoil)[<span class="dv">3576</span><span class="sc">:</span><span class="dv">3600</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "m605.545" "m603.617" "m601.688" "m599.76"  "BSAN"     "BSAS"    
 [7] "BSAV"     "CTI"      "ELEV"     "EVI"      "LSTD"     "LSTN"    
[13] "REF1"     "REF2"     "REF3"     "REF7"     "RELI"     "TMAP"    
[19] "TMFI"     "Depth"    "Ca"       "P"        "pH"       "SOC"     
[25] "Sand"    </code></pre>
</div>
</div>
<p>Let’s try predicting <strong>pH</strong>, the acidity. But that leaves 3599 possible predictors. There is an old rule of thumb that one should have <span class="math inline">\(p &lt; \sqrt{n}\)</span>, for <span class="math inline">\(p\)</span> predictors and <span class="math inline">\(n\)</span> data points, to avoid overfitting, a rule which in our setting of <span class="math inline">\(n = 1157\)</span> is grossly violated. We need to do dimension reduction. One way to accomplish this is to use PCA.</p>
<p>(Note, though, that this presumes our goal is prediction, rather than effect estimation. In the latter case, our new variables will be principal components, and their regression coefficients may not be meaningful to us. If we are doing prediction, regression coefficients may not be of interest.)</p>
</section>
<section id="overall-idea" class="level2" data-number="10.2">
<h2 data-number="10.2" class="anchored" data-anchor-id="overall-idea"><span class="header-section-number">10.2</span> Overall Idea</h2>
<p>The goal is to find a few important linear combinations of our original predictor variables–important in the sense that they roughly summarize our data. These new variables are called the <em>principal components</em> (PCs) of the data. Let’s see how this is done.</p>
<section id="sec-firstPC" class="level3" data-number="10.2.1">
<h3 data-number="10.2.1" class="anchored" data-anchor-id="sec-firstPC"><span class="header-section-number">10.2.1</span> The first PC</h3>
<p>Let <strong>X</strong> denote a set of variables of interest (not necessarily in a prediction context). In searching for good linear combinations, we want to aim for ones with high variance. We certainly don’t want ones with low variance; after all, a random variable with 0 variance is a constant. So we wish to find linear combinations</p>
<p><span class="math display">\[
Xu
\]</span></p>
<p>which maximize</p>
<p><span class="math display">\[
Var(Xu) = u' Cov(X) u
\]</span></p>
<p>where we have invoked <a href="Ch2a.html#eq-acova">Equation&nbsp;<span>4.4</span></a>.</p>
<p>But that goal is ill-defined, since we could take larger and larger vectors <span class="math inline">\(u\)</span>, thus larger and larger vectors <span class="math inline">\(Xu\)</span>, no maximum. So, let’s constrain it to vectors <span class="math inline">\(u\)</span> of length 1:</p>
<p><span class="math display">\[
u'u = 1
\]</span></p>
<p>The method of <em>Lagrange multipliers</em> is used to solve maximum/minimum problems that have constraints, by adding a new variable corresponding to the constraint. In our case, we maximize</p>
<p><span class="math display">\[
u'Cov(X)u + \gamma (u'u - 1)
\]</span></p>
<p>with respect to <span class="math inline">\(u\)</span> and <span class="math inline">\(\gamma\)</span>.</p>
<p>Setting derivatives to 0, we have</p>
<p><span class="math display">\[
0 =
2 Cov(X) u + 2 \gamma u
\]</span></p>
<p>and</p>
<p><span class="math display">\[
0 = u'u - 1
\]</span></p>
<p>In other words,</p>
<p><span id="eq-aha"><span class="math display">\[
Cov(X) ~ u = -\gamma u
\tag{10.1}\]</span></span></p>
<p>A matrix times a vector equals a constant times that same vector. That opens a huge world. We will return to the notion of principal components in the next chapter, after laying the groundwork in the current chapter.</p>
</section>
</section>
<section id="definition" class="level2" data-number="10.3">
<h2 data-number="10.3" class="anchored" data-anchor-id="definition"><span class="header-section-number">10.3</span> Definition</h2>
<p>The concept itself is simple:</p>
<blockquote class="blockquote">
<p>Consider an <span class="math inline">\(m \textrm{ x } m\)</span> matrix <span class="math inline">\(M\)</span>. If there is a nonzero vector <span class="math inline">\(x\)</span> and a number <span class="math inline">\(\lambda\)</span> such that</p>
<p><span id="eq-simpledef"><span class="math display">\[
Mx = \lambda x
\tag{10.2}\]</span></span></p>
<p>we say that <span class="math inline">\(\lambda\)</span> is an <em>eigenvalue</em> of <span class="math inline">\(M\)</span>, with <em>eigenvector</em> <span class="math inline">\(x\)</span>.</p>
</blockquote>
</section>
<section id="a-first-look" class="level2" data-number="10.4">
<h2 data-number="10.4" class="anchored" data-anchor-id="a-first-look"><span class="header-section-number">10.4</span> A First Look</h2>
<p>Here are a few properties to start with:</p>
<ul>
<li><p>The definition is equivalent to</p>
<p><span class="math display">\[
(M - \lambda I) x = 0
\]</span></p>
<p>which in turn implies that <span class="math inline">\(M - \lambda I\)</span> is noninvertible. That then implies that</p>
<p><span class="math display">\[
det(M - \lambda I) = 0
\]</span></p></li>
<li><p>The left-hand side of this equation is a polynomial in <span class="math inline">\(\lambda\)</span>. So for an <span class="math inline">\(n \textrm{ x } n\)</span> matrix <span class="math inline">\(M\)</span>, there are <span class="math inline">\(n\)</span> roots of the equation and thus <span class="math inline">\(n\)</span> eigenvalues. Note that some roots may be repeated; if <span class="math inline">\(M\)</span> is the zero matrix, it will have an eigenvalue <span class="math inline">\(0\)</span> with multiplicity <span class="math inline">\(n\)</span>.</p></li>
<li><p>In principle, that means we can solve the above determinant equation to find the eigenvalues of the matrix. The comments in <a href="Ch2.html#sec-detdef"><span>Section&nbsp;3.5.1</span></a> regarding the “ugly” definition of determinants imply that the equation involves a degree-<span class="math inline">\(m\)</span> polynomial in <span class="math inline">\(\lambda\)</span>.</p></li>
<li><p>There are much better ways to calculate the eigenvalues than this, but a useful piece information arising from that analysis is that <span class="math inline">\(M\)</span> as <span class="math inline">\(m\)</span> eigenvalues (not necessarily distinct).</p></li>
</ul>
</section>
<section id="the-special-case-of-symmetric-matrices" class="level2" data-number="10.5">
<h2 data-number="10.5" class="anchored" data-anchor-id="the-special-case-of-symmetric-matrices"><span class="header-section-number">10.5</span> The Special Case of Symmetric Matrices</h2>
<p>Many matrices in data science are symmetric, such as covariance matrices and <span class="math inline">\(A'A\)</span> in <a href="Ch3.html#eq-linregformula">Equation&nbsp;<span>5.4</span></a>.</p>
<section id="eigenvalues-are-real" class="level3" data-number="10.5.1">
<h3 data-number="10.5.1" class="anchored" data-anchor-id="eigenvalues-are-real"><span class="header-section-number">10.5.1</span> Eigenvalues are real</h3>
<p>Some eigenvalues may be complex numbers, i.e.&nbsp;of the form <span class="math inline">\(a+bi\)</span>, but it can be shown that if <span class="math inline">\(M\)</span> is symmetric, its eigenvalues are guaranteed to be real. This is good news for data science, as many matrices in that field are symmetric, such covariance matrices.</p>
</section>
<section id="sec-eigortho" class="level3" data-number="10.5.2">
<h3 data-number="10.5.2" class="anchored" data-anchor-id="sec-eigortho"><span class="header-section-number">10.5.2</span> Eigenvectors are orthogonal</h3>
<blockquote class="blockquote">
<p>Eigenvectors corresponding to distinct eigenvalues of a symmetric matrix <span class="math inline">\(M\)</span> are othogonal.</p>
<p><em>Proof:</em> Let <span class="math inline">\(u\)</span> and <span class="math inline">\(v\)</span> be such eigenvectors, corresponding to eigenvalues <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\nu\)</span>.</p>
<p><span class="math display">\[
\mu' M \nu = (\mu' M \nu)' = \nu' M' \mu = \nu' M \mu
\]</span></p>
<p>(in that first equality, we used the fact that the transpose of a number is that number). Substitute for <span class="math inline">\(M\nu\)</span> and <span class="math inline">\(M\mu\)</span>, then subtract.</p>
</blockquote>
</section>
<section id="sec-diagonalizable" class="level3" data-number="10.5.3">
<h3 data-number="10.5.3" class="anchored" data-anchor-id="sec-diagonalizable"><span class="header-section-number">10.5.3</span> Symmetric matrices are diagonalizable</h3>
<p>A square matrix <span class="math inline">\(R\)</span> is said to be <em>diagonalizable</em> if there exists an invertible matrix <span class="math inline">\(P\)</span> such that <span class="math inline">\(P^{-1}RP\)</span> is equal to some diagonal matrix <span class="math inline">\(D\)</span>. We see that symmetric matrices fall into this category.</p>
<p>One application of this is the computation of powers of a diagonal matrix:</p>
<p><span class="math display">\[
R^k = P^{-1}RP ~ P^{-1}RP ~ ... ~ P^{-1}RP = P^{-1}D^kP
\]</span></p>
<p><span class="math inline">\(D^k\)</span> is equal to the diagonal matrix with elements <span class="math inline">\(d_k^k\)</span>, so the computation of <span class="math inline">\(M^k\)</span> is easy.</p>
<div id="thm-symmeig" class="theorem">
<p><span class="theorem-title"><strong>Theorem 10.1 </strong></span>Any symmetric matrix <span class="math inline">\(M\)</span> has the following properties</p>
<ul>
<li><p><span class="math inline">\(M\)</span> is diagonalizable.</p></li>
<li><p>In fact, the matrix <span class="math inline">\(P\)</span> is equal to the matrix whose columns are the eigenvectors of <span class="math inline">\(M\)</span>, chosen to have length 1.</p></li>
<li><p>The associated diagonal matrix has as its diagonal elements the eigenvalues of <span class="math inline">\(M\)</span>.</p></li>
<li><p>The matrix <span class="math inline">\(P\)</span> has the property that <span class="math inline">\(P^{-1} = P'\)</span>.</p></li>
<li><p>Moreover, the rank of <span class="math inline">\(M\)</span> is equal to the number of nonzero eigenvalues of <span class="math inline">\(M\)</span>.</p></li>
</ul>
</div>
<div class="proof">
<p><span class="proof-title"><em>Proof</em>. </span>Use partitioned matrices.</p>
<p>Let <span class="math inline">\(D = diag(d_1,...,d_m)\)</span>, where the <span class="math inline">\(d_i\)</span> are the eigenvalues of <span class="math inline">\(M\)</span>, corresponding to eigenvectors <span class="math inline">\(P_i\)</span>. Set the latter to have length 1, by dividing by their lengths.</p>
<p>Recall that the eigenvectors of <span class="math inline">\(M\)</span>, i.e.&nbsp;the columns of <span class="math inline">\(P\)</span>, are orthogonal. That means the rows of <span class="math inline">\(P'\)</span> are orthogonal. Again using partitioning, we see that</p>
<p><span class="math display">\[
P'P = I
\]</span></p>
<p>so that <span class="math inline">\(P^{-1} = P'\)</span>.</p>
<p>By the way, any square matrix <span class="math inline">\(Q\)</span> such that <span class="math inline">\(Q'Q = I\)</span> is said to be <em>orthogonal</em>.</p>
<p>Now write</p>
<p><span class="math display">\[
MP = M(P_1 | ... | P_m) = (MP_1 | ... | MP_n) =
(d_1 P_1 | ... | (d_m P_m) = PD
\]</span></p>
<p>Multiply on the left by <span class="math inline">\(P'\)</span>, and we are done.</p>
<p>Regarding rank, <a href="Ch4.html#thm-ranknotchange">Theorem&nbsp;<span>6.1</span></a> tells us that pre- or postmultiplying by an invertible matrix does not change rank, and clearly the rank of a diagonal matrix is the number of nonzero elements.</p>
<p><span class="math inline">\(\square\)</span></p>
</div>
</section>
<section id="example-census-dataset" class="level3" data-number="10.5.4">
<h3 data-number="10.5.4" class="anchored" data-anchor-id="example-census-dataset"><span class="header-section-number">10.5.4</span> Example: Census dataset</h3>
<p>Let’s illustrate all this with the data in <a href="Ch5c.html#sec-pgtn"><span>Section&nbsp;9.5</span></a>. We will form the matrix <span class="math inline">\(A'A\)</span> in <a href="Ch3.html#sec-linregformula"><span>Section&nbsp;5.3.3</span></a>, which as mentioned, is symmetric.</p>
<p>Recall that in that example, <span class="math inline">\(A\)</span> is not of full rank. Thus we should expect to see a 0 eigenvalue.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(qeML)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(svcensus)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>svc <span class="ot">&lt;-</span> svcensus[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">4</span><span class="sc">:</span><span class="dv">6</span>)]</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>svc<span class="sc">$</span>man <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(svc<span class="sc">$</span>gender <span class="sc">==</span> <span class="st">'male'</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>svc<span class="sc">$</span>woman <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(svc<span class="sc">$</span>gender <span class="sc">==</span> <span class="st">'female'</span>)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>svc<span class="sc">$</span>gender <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(svc[,<span class="sc">-</span><span class="dv">2</span>])</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="dv">1</span>,a)  <span class="co"># add the column of 1s</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">t</span>(a) <span class="sc">%*%</span> a</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>eigs <span class="ot">&lt;-</span> <span class="fu">eigen</span>(m)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>eigs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>eigen() decomposition
$values
[1] 7.594762e+07 3.292955e+06 7.466971e+03 1.293594e+03 2.801489e-12

$vectors
             [,1]         [,2]         [,3]        [,4]          [,5]
[1,] -0.015881850  0.004389585 -0.035995373  0.81553633  5.773503e-01
[2,] -0.649660696  0.760031134  0.004461047 -0.01654550  1.561251e-17
[3,] -0.759952974 -0.649864420  0.004991922 -0.01108122 -4.061024e-17
[4,] -0.012070494  0.002130704 -0.724401141  0.37650952 -5.773503e-01
[5,] -0.003811356  0.002258881  0.688405767  0.43902681 -5.773503e-01</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>m <span class="sc">%*%</span> eigs<span class="sc">$</span>vectors[,<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>               [,1]
         -1206188.6
age     -49340181.0
wkswrkd -57716616.5
man       -916725.2
woman     -289463.4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>eigs<span class="sc">$</span>values[<span class="dv">1</span>] <span class="sc">%*%</span> eigs<span class="sc">$</span>vectors[,<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         [,1]      [,2]      [,3]      [,4]      [,5]
[1,] -1206189 -49340181 -57716617 -916725.2 -289463.4</code></pre>
</div>
</div>
<p>Yes, that first column is indeed an eigenvector, with the claimed eigenvalue.</p>
<p>Note that the expected 0 eigenvalue shows up as 2.801489e-12, quite small but nonzero, due to roundoff error.</p>
</section>
</section>
<section id="application-detecting-multicollinearity" class="level2" data-number="10.6">
<h2 data-number="10.6" class="anchored" data-anchor-id="application-detecting-multicollinearity"><span class="header-section-number">10.6</span> Application: Detecting Multicollinearity</h2>
<p>Consider the basic eigenanalysis equation,</p>
<p><span class="math display">\[
Ax = \lambda x
\]</span></p>
<p>for a square matrix <span class="math inline">\(A\)</span>, a conformable vector <span class="math inline">\(x\)</span> and a scalar <span class="math inline">\(\lambda\)</span>. Suppose that, roughly speaking, <span class="math inline">\(\lambda x\)</span> is small relative to <span class="math inline">\(A\)</span>. Then</p>
<p><span class="math display">\[
Ax \approx 0
\]</span></p>
<p>and since <span class="math inline">\(Ax\)</span> is a linear combination of the columns of <span class="math inline">\(A\)</span>, we thus we have found multicollinearity in <span class="math inline">\(A\)</span>.</p>
<p>One often sees use of the <em>condition number</em> of a matrix, which is the ratio of the largest eigenvalue to the smallest one. This too might be used as a suggestion of multicollinearity, though the main usage is as a signal that matrix operations such finding inverses may have significant problems with roundoff error.</p>
</section>
<section id="example-currency-data" class="level2" data-number="10.7">
<h2 data-number="10.7" class="anchored" data-anchor-id="example-currency-data"><span class="header-section-number">10.7</span> Example: Currency Data</h2>
<p>This dataset tracks five pre-euro European currencies.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(qeML)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(currency)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(currency)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Can..dollar Ger..mark Fr..franc UK.pound J..yen
1          19       580     4.763       29    602
2          18       609     4.818       44    609
3          20       618     4.806       66    613
4          46       635     4.825       79    607
5          42       631     4.796       77    611
6          45       635     4.818       74    610</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(currency)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 762   5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>crc <span class="ot">&lt;-</span> currency</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>crc <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(crc)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>crcapa <span class="ot">&lt;-</span> <span class="fu">t</span>(crc) <span class="sc">%*%</span> crc</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>eigs <span class="ot">&lt;-</span> <span class="fu">eigen</span>(crcapa)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>eigs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>eigen() decomposition
$values
[1] 4.180990e+08 5.356321e+07 8.199388e+06 4.686379e+06 4.764149e+02

$vectors
             [,1]         [,2]         [,3]          [,4]          [,5]
[1,] -0.464701846 -0.589664107  0.573442227  0.3277874495 -0.0082362154
[2,] -0.548123722  0.364936898 -0.424252867  0.6216029591 -0.0008432535
[3,] -0.008118519 -0.002208129  0.005818183 -0.0005349635  0.9999475368
[4,] -0.541352395 -0.364398075 -0.476833987 -0.5888747450 -0.0027404807
[5,] -0.436445017  0.621551662  0.513584476 -0.3992385223 -0.0053728096</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># illustrate Ax = lambda x</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>crcapa <span class="sc">%*%</span> eigs<span class="sc">$</span>vectors[,<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   [,1]
Can..dollar  -3.9238561
Ger..mark    -0.4017386
Fr..franc   476.3899505
UK.pound     -1.3056059
J..yen       -2.5596868</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>eigs<span class="sc">$</span>values[<span class="dv">5</span>] <span class="sc">*</span>  eigs<span class="sc">$</span>vectors[,<span class="dv">5</span>] </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  -3.9238561  -0.4017386 476.3899505  -1.3056060  -2.5596868</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># is Ax small?</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(crcapa)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            Can..dollar Ger..mark  Fr..franc  UK.pound    J..yen
Can..dollar   112111475  93929522 1673631.29 113542760  66967756
Ger..mark      93929522 136033582 1795560.29 116882053 109220119
Fr..franc       1673631   1795560   28573.49   1859363   1433430
UK.pound      113542760 116882053 1859363.20 133130962  85746625
J..yen         66967756 109220119 1433430.43  85746625 103243878</code></pre>
</div>
</div>
<p>So yes, this dataset has some multicollinearity.</p>
</section>
<section id="computation-the-power-method" class="level2" data-number="10.8">
<h2 data-number="10.8" class="anchored" data-anchor-id="computation-the-power-method"><span class="header-section-number">10.8</span> Computation: the Power Method</h2>
<p>One way to compute eigenvalues and eigenvectors is the <em>power method</em>, a simple iteration. We begin with an initial guess, <span class="math inline">\(x_0\)</span> for an eigenvector. Substituting in <a href="#eq-simpledef">Equation&nbsp;<span>10.2</span></a>, we have the next guess:</p>
<p><span class="math display">\[
x_1 = M x_0
\]</span></p>
<p>We keep iterating until convergence, generating <span class="math inline">\(x_2\)</span> from <span class="math inline">\(x_1\)</span> and so on. However, the <span class="math inline">\(x_i\)</span> may grow, so we normalize to length 1:</p>
<p><span class="math display">\[
x_i \leftarrow \frac{x_i}{||x_i||}
\]</span></p>
</section>
<section id="application-computation-of-long-run-distribution-in-markov-chains" class="level2" data-number="10.9">
<h2 data-number="10.9" class="anchored" data-anchor-id="application-computation-of-long-run-distribution-in-markov-chains"><span class="header-section-number">10.9</span> Application: Computation of Long-Run Distribution in Markov Chains</h2>
<p>We showed in <a href="Ch2.html#sec-markovsolve"><span>Section&nbsp;3.1</span></a> how matrix inverse can be used to compute the long-run distribution <span class="math inline">\(\nu\)</span> in a Markov chain. However, this is inefficient for very large transition matrices. For instance, in Google PageRank, there is a Markov state for every page on the Web!</p>
<p>Instead, we exploit the fact that <a href="Ch2.html#eq-MarkovPi">Equation&nbsp;<span>3.1</span></a> says that the transition matrix has an eigenvector <span class="math inline">\(\nu\)</span> with eigenvalue 1. Due to the typical huge size of the matrix, the power method or a variant is often used.</p>
</section>
<section id="your-turn" class="level2" data-number="10.10">
<h2 data-number="10.10" class="anchored" data-anchor-id="your-turn"><span class="header-section-number">10.10</span> Your Turn</h2>
<p>❄️ <strong>Your Turn:</strong> Show that the diagonalizing matrix <span class="math inline">\(P\)</span> above must have determinant <span class="math inline">\(\pm 1\)</span>.</p>
<p>❄️ <strong>Your Turn:</strong> Show that if <span class="math inline">\(x\)</span> is an eigenvector of <span class="math inline">\(M\)</span> with eigenvalue <span class="math inline">\(\lambda \neq 0\)</span>, then for any nonzero number <span class="math inline">\(c\)</span>, <span class="math inline">\(cx\)</span> will also be an eigenvector with eigenvalue <span class="math inline">\(\lambda\)</span>.</p>
<p>❄️ <strong>Your Turn:</strong> Show that if a matrix <span class="math inline">\(M\)</span> has a 0 eigenvalue, <span class="math inline">\(M\)</span> must be singular. Also prove the converse. (Hint: Consider the column rank.)</p>
<p>❄️ <strong>Your Turn:</strong> Consider a projection matrix <span class="math inline">\(P_W\)</span>. Show that the only possible eigenvalues are 0 and 1. Hint: Recall that projection matrices are idempotent.</p>
<p>❄️ <strong>Your Turn:</strong> Say <span class="math inline">\(A\)</span> is an invertible matrix with eigenvalue <span class="math inline">\(\lambda\)</span> and eigenvector <span class="math inline">\(v\)</span>. Show that <span class="math inline">\(v\)</span> is also an eigenvector of <span class="math inline">\(A^{-1}\)</span>, with eigenvalue <span class="math inline">\(1/\lambda\)</span>.</p>
<p>❄️ <strong>Your Turn:</strong> Show that if <span class="math inline">\(A\)</span> is nonnegative-definite, its eigenvalues must be nonnegative.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./Ch5c.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Shrinkage Estimators</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./Ch6b.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Principal Components</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>