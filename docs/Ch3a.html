<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>6&nbsp; Confidence Sets – Powered by Linear Algebra</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./Ch4.html" rel="next">
<link href="./Ch3.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-5e2915e4d4df5928b2b0a61215b328b6.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Ch3a.html"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Confidence Sets</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Powered by Linear Algebra</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">index.html</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Matrices and Vectors</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Matrix Inverse</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch2a.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Covariance Matrices, MV Normal Distribution</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Linear Statistical Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch3a.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Confidence Sets</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Matrix Rank</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch5a.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Vector Spaces</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch5b.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Inner Product Spaces</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch5bb.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Four Fundamental Spaces</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch5c.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Shrinkage Estimators</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch6a.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Eigenanalysis</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch6b.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Principal Components</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch6c.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Singular Value Decomposition</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch6d.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">A Deeper Look at Overfitting</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch8a.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Attention</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contents</h2>
   
  <ul>
  <li><a href="#review-confidence-intervals-standard-errors" id="toc-review-confidence-intervals-standard-errors" class="nav-link active" data-scroll-target="#review-confidence-intervals-standard-errors"><span class="header-section-number">6.1</span> Review: Confidence Intervals, Standard Errors</a></li>
  <li><a href="#sec-rcov" id="toc-sec-rcov" class="nav-link" data-scroll-target="#sec-rcov"><span class="header-section-number">6.2</span> The R vcov Function</a>
  <ul class="collapse">
  <li><a href="#example-iranian-churn-data" id="toc-example-iranian-churn-data" class="nav-link" data-scroll-target="#example-iranian-churn-data"><span class="header-section-number">6.2.1</span> Example: Iranian churn data</a></li>
  </ul></li>
  <li><a href="#the-delta-method" id="toc-the-delta-method" class="nav-link" data-scroll-target="#the-delta-method"><span class="header-section-number">6.3</span> The Delta Method</a>
  <ul class="collapse">
  <li><a href="#motivating-example" id="toc-motivating-example" class="nav-link" data-scroll-target="#motivating-example"><span class="header-section-number">6.3.1</span> Motivating example</a></li>
  <li><a href="#use-of-the-central-limit-theorem" id="toc-use-of-the-central-limit-theorem" class="nav-link" data-scroll-target="#use-of-the-central-limit-theorem"><span class="header-section-number">6.3.2</span> Use of the Central Limit Theorem</a></li>
  <li><a href="#use-of-the-multivariate-central-limit-theorem" id="toc-use-of-the-multivariate-central-limit-theorem" class="nav-link" data-scroll-target="#use-of-the-multivariate-central-limit-theorem"><span class="header-section-number">6.3.3</span> Use of the Multivariate Central Limit Theorem</a></li>
  <li><a href="#example-ratio-of-two-means" id="toc-example-ratio-of-two-means" class="nav-link" data-scroll-target="#example-ratio-of-two-means"><span class="header-section-number">6.3.4</span> Example: ratio of two means</a></li>
  </ul></li>
  <li><a href="#example-motherdaughter-height-data" id="toc-example-motherdaughter-height-data" class="nav-link" data-scroll-target="#example-motherdaughter-height-data"><span class="header-section-number">6.4</span> Example: Mother/Daughter Height Data</a></li>
  <li><a href="#regarding-those-pesky-derivatives" id="toc-regarding-those-pesky-derivatives" class="nav-link" data-scroll-target="#regarding-those-pesky-derivatives"><span class="header-section-number">6.5</span> Regarding Those Pesky Derivatives</a></li>
  <li><a href="#scheffes-method" id="toc-scheffes-method" class="nav-link" data-scroll-target="#scheffes-method"><span class="header-section-number">6.6</span> Scheffe’s Method</a>
  <ul class="collapse">
  <li><a href="#a-confidence-set-for-widehatbeta-in-the-linear-model" id="toc-a-confidence-set-for-widehatbeta-in-the-linear-model" class="nav-link" data-scroll-target="#a-confidence-set-for-widehatbeta-in-the-linear-model"><span class="header-section-number">6.6.1</span> A confidence set for <span class="math inline">\(\widehat{\beta}\)</span> in the linear model</a></li>
  <li><a href="#sec-lagrange" id="toc-sec-lagrange" class="nav-link" data-scroll-target="#sec-lagrange"><span class="header-section-number">6.6.2</span> Lagrange multipliers</a></li>
  <li><a href="#simultaneous-confidence-intervals-for-quantities-abeta" id="toc-simultaneous-confidence-intervals-for-quantities-abeta" class="nav-link" data-scroll-target="#simultaneous-confidence-intervals-for-quantities-abeta"><span class="header-section-number">6.6.3</span> Simultaneous confidence intervals for quantities <span class="math inline">\(a'\beta\)</span></a></li>
  </ul></li>
  <li><a href="#your-turn" id="toc-your-turn" class="nav-link" data-scroll-target="#your-turn"><span class="header-section-number">6.7</span> Your Turn</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-confsets" class="quarto-section-identifier"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Confidence Sets</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div style="page-break-after: always;"></div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Goals of this chapter:
</div>
</div>
<div class="callout-body-container callout-body">
<p>The reader is probably already familiar with the concept of a <em>confidence interval</em> (CI). But that is just in one dimension. Confidence intervals are even more useful in the multidimensional setting. In this chapter, we introduce a fairly general method of forming a CI from multivariate data, and then extend the notion to <em>confidence sets</em> for unknown multivariate quantities themselves. As the reader may have guessed, the word “multivariate” here is a sign that linear algebra is involved, which will indeed be the case.</p>
</div>
</div>
<section id="review-confidence-intervals-standard-errors" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="review-confidence-intervals-standard-errors"><span class="header-section-number">6.1</span> Review: Confidence Intervals, Standard Errors</h2>
<p>To set the stage, let’s review the statistical concepts of <em>confidence interval</em> and <em>standard error</em>. Say we have an estimator <span class="math inline">\(\widehat{\theta}\)</span> of some population parameter <span class="math inline">\(\theta\)</span>, e.g.&nbsp;<span class="math inline">\(\bar{X}\)</span> for a population mean <span class="math inline">\(\mu\)</span>.</p>
<p>Loosely speaking, the term <em>standard error</em> of is our estimate of <span class="math inline">\(\sqrt{Var(\widehat{\theta})}\)</span>. More precisely, suppose that <span class="math inline">\(\widehat{\theta}\)</span> is asymptotically normal. The standard error is an estimate of the standard deviation of that normal distribution. For this reason, It is customary to write <span class="math inline">\(AVar(\widehat{\theta})\)</span> rather than <span class="math inline">\(Var(\widehat{\theta})\)</span>.</p>
<p>This can be used to form a confidence interval (see below), but also stands on its own as an indication of the accuracy of <span class="math inline">\(\widehat{\theta}\)</span>.</p>
<p>A, say 95%, confidence interval (CI) for <span class="math inline">\(\mu\)</span> is then</p>
<p><span class="math display">\[
\widehat{\theta} \pm 1.96 ~ \widehat{\theta}
\]</span></p>
<p>The 95% figure means that of all possible samples of the given size from the population, 95% of the resulting confidence intervals will contain <span class="math inline">\(\theta\)</span>. In many cases, the 95% figure is only approximate, stemming from a derivation that uses the Central Limit Theorem.</p>
<p>In general, for confidence level <span class="math inline">\(1-\alpha\)</span> replace 1.96 by the upper <span class="math inline">\(z_{\alpha}\)</span>, the <span class="math inline">\(1-\alpha/2\)</span> quantile of the N(0,1) distribution, and denote the standard error of <span class="math inline">\(\widehat{\theta}\)</span> by <span class="math inline">\(\textrm{SE}(\widehat{\theta})\)</span>. Then our CI is</p>
<p><span id="eq-pmse"><span class="math display">\[
\widehat{\theta} \pm z_{\alpha} \textrm{SE}(\widehat{\theta})
\tag{6.1}\]</span></span></p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note Regarding Sensitivity of Phrasing
</div>
</div>
<div class="callout-body-container callout-body">
<p>There is a bit of drama in this word “contain.” Instead of saying the intervals <em>contain</em> <span class="math inline">\(\theta\)</span>, why not simply say <span class="math inline">\(\theta\)</span> is <em>in</em> the intervals? Aren’t these two descriptions equivalent in terms of English? Of course they are. But many instructors of statistics classes worry that students will take the second description to mean that <span class="math inline">\(\theta\)</span> is the random quantity, when in fact the CI is random (random center, random radius) and <span class="math inline">\(\theta\)</span> is fixed (though unknown). The instructors thus insist on the more awkward phrasing, so as to avoid students misunderstanding. Indeed some instructors would contend that use of the word <em>in</em> is itself just plain incorrect. My own view is that in some cases the word <em>in</em> is clearer (and certainly correct in any case), and that it is better to add a warning about what is random/nonrandom than engage in awkward phrasing.</p>
</div>
</div>
</section>
<section id="sec-rcov" class="level2 page-columns page-full" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="sec-rcov"><span class="header-section-number">6.2</span> The R vcov Function</h2>
<p>So, how does one obtain standard errors? In R, in many cases, they will be provided by the <strong>summary</strong> function, but we may need an entire estimated covariance matrix rather than just a standard error.</p>
<div class="page-columns page-full"><p>Due to the Multivariate Central Limit Theorem, many common statistical estimators have approximately normal distributions. In R, functions such as <strong>lm</strong>, <strong>glm</strong>, <strong>lme</strong> and <strong>coxph</strong> come with an associated function <strong>vcov</strong>. This gives the approximate covariance matrix of the computed estimator, e.g.&nbsp;for the estimated coefficients vector in a linear model. This enables formation of approximate confidence intervals for not only individual model parameters but also linear combinations of them, as well as computing other quantities related to confidence sets. </p><div class="no-row-height column-margin column-container"><span class="">The <strong>vcov</strong> function is an R <em>generic</em> function, playing a similar role to <strong>print</strong>, <strong>plot</strong>, <strong>summary</strong> and so on. Many R statistical functions have this for their output, including <strong>lm</strong>. When we make the call <strong>vcov(glmOut)</strong>, the R interpreter sees that <strong>glmOut</strong> is of class “glm” and thus transfers the call to the class-specific function, <strong>vcov.glm(glmOut)</strong>. The function <strong>coef</strong>, also used here, is also generic.</span></div></div>
<section id="example-iranian-churn-data" class="level3" data-number="6.2.1">
<h3 data-number="6.2.1" class="anchored" data-anchor-id="example-iranian-churn-data"><span class="header-section-number">6.2.1</span> Example: Iranian churn data</h3>
<p>Here we predict whether a telecom customer will move to another provider. We obtain <span class="math inline">\(AVar(\widehat{\beta})\)</span> using the <strong>vcov</strong> function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(IranianChurn)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>glmOut <span class="ot">&lt;-</span> <span class="fu">glm</span>(Exited <span class="sc">~</span> ., <span class="at">data =</span> iranChurn, <span class="at">family =</span> binomial)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>acov <span class="ot">&lt;-</span> <span class="fu">vcov</span>(glmOut)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>acov</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   (Intercept)   CreditScore GeographyGermany GeographySpain
(Intercept)       5.993100e-02 -5.051370e-05    -1.589878e-04  -1.388436e-03
CreditScore      -5.051370e-05  7.859301e-08    -2.683572e-07  -2.454056e-07
GeographyGermany -1.589878e-04 -2.683572e-07     4.579770e-03   1.678887e-03
GeographySpain   -1.388436e-03 -2.454056e-07     1.678887e-03   4.989715e-03
GenderMale       -1.350817e-03  2.156023e-07     2.008595e-05  -2.200094e-05
Age              -2.685656e-04 -7.969688e-09     6.042109e-06  -2.107579e-06
Tenure           -4.049072e-04  1.614151e-09    -6.645863e-06   3.828636e-06
Balance          -2.936332e-08  1.033099e-13    -1.358788e-08  -2.156656e-11
NumOfProducts    -3.775016e-03 -8.271320e-08    -3.655500e-04  -3.357316e-05
HasCrCard1       -2.595873e-03  2.066409e-07    -7.611739e-05   3.603876e-05
IsActiveMember1   5.010389e-04 -3.102862e-07    -1.008754e-04  -3.954646e-05
EstimatedSalary  -2.301952e-08  1.070775e-12    -7.124867e-11  -8.778366e-11
                    GenderMale           Age        Tenure       Balance
(Intercept)      -1.350817e-03 -2.685656e-04 -4.049072e-04 -2.936332e-08
CreditScore       2.156023e-07 -7.969688e-09  1.614151e-09  1.033099e-13
GeographyGermany  2.008595e-05  6.042109e-06 -6.645863e-06 -1.358788e-08
GeographySpain   -2.200094e-05 -2.107579e-06  3.828636e-06 -2.156656e-11
GenderMale        2.968982e-03 -4.697135e-06 -7.714322e-06 -9.609423e-10
Age              -4.697135e-06  6.633235e-06 -2.330915e-07  4.769766e-11
Tenure           -7.714322e-06 -2.330915e-07  8.751351e-05 -1.419504e-11
Balance          -9.609423e-10  4.769766e-11 -1.419504e-11  2.644146e-13
NumOfProducts     5.853316e-05  2.887014e-06 -2.575910e-06  6.486034e-09
HasCrCard1       -8.288460e-06  1.405830e-07 -1.356629e-05  6.276417e-10
IsActiveMember1   2.637202e-05 -3.924088e-05  1.978922e-05 -5.129968e-10
EstimatedSalary   1.976874e-10  1.824674e-11 -7.850909e-11 -3.430272e-15
                 NumOfProducts    HasCrCard1 IsActiveMember1 EstimatedSalary
(Intercept)      -3.775016e-03 -2.595873e-03    5.010389e-04   -2.301952e-08
CreditScore      -8.271320e-08  2.066409e-07   -3.102862e-07    1.070775e-12
GeographyGermany -3.655500e-04 -7.611739e-05   -1.008754e-04   -7.124867e-11
GeographySpain   -3.357316e-05  3.603876e-05   -3.954646e-05   -8.778366e-11
GenderMale        5.853316e-05 -8.288460e-06    2.637202e-05    1.976874e-10
Age               2.887014e-06  1.405830e-07   -3.924088e-05    1.824674e-11
Tenure           -2.575910e-06 -1.356629e-05    1.978922e-05   -7.850909e-11
Balance           6.486034e-09  6.276417e-10   -5.129968e-10   -3.430272e-15
NumOfProducts     2.221635e-03 -3.379445e-06   -3.685755e-05   -4.030670e-10
HasCrCard1       -3.379445e-06  3.521179e-03    6.930480e-05    3.401694e-11
IsActiveMember1  -3.685755e-05  6.930480e-05    3.327629e-03    2.676211e-10
EstimatedSalary  -4.030670e-10  3.401694e-11    2.676211e-10    2.243567e-13</code></pre>
</div>
</div>
<p>There are several categorical variables here, so after expansion to dummies, <span class="math inline">\(AVar(\widehat{\beta})\)</span> is <span class="math inline">\(12 \times 12\)</span>. This is the covariance matrix for the vector of estimated logistic regression coefficients <span class="math inline">\(\widehat{\beta}\)</span>.</p>
<p>Say we wish to compare Germany and Spain. The difference will be of the form <span class="math inline">\(a'\beta\)</span>. What should we take for <span class="math inline">\(a\)</span>?</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">row.names</span>(acov)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a> [<span class="dv">1</span>] <span class="st">"(Intercept)"</span>      <span class="st">"CreditScore"</span>      <span class="st">"GeographyGermany"</span> <span class="st">"GeographySpain"</span>  </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a> [<span class="dv">5</span>] <span class="st">"GenderMale"</span>       <span class="st">"Age"</span>              <span class="st">"Tenure"</span>           <span class="st">"Balance"</span>         </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a> [<span class="dv">9</span>] <span class="st">"NumOfProducts"</span>    <span class="st">"HasCrCard1"</span>       <span class="st">"IsActiveMember1"</span>  <span class="st">"EstimatedSalary"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Ah, we set <span class="math inline">\(a\)</span> to (0,0,1,-1,0,0,0,0,0,0,0,0)’. Using <a href="Ch2a.html#eq-quadform" class="quarto-xref">Equation&nbsp;<span>4.6</span></a>, we compute the standard error and the CI:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="sc">-</span><span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>avar <span class="ot">&lt;-</span> <span class="fu">t</span>(a) <span class="sc">%*%</span> acov <span class="sc">%*%</span> a</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>se <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(avar)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>estdiff <span class="ot">&lt;-</span> <span class="fu">t</span>(a) <span class="sc">%*%</span> <span class="fu">coef</span>(glmOut)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(estdiff<span class="fl">-1.96</span><span class="sc">*</span>se,estdiff<span class="fl">+1.96</span><span class="sc">*</span>se)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.5850204 0.8939729</code></pre>
</div>
</div>
</section>
</section>
<section id="the-delta-method" class="level2 page-columns page-full" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="the-delta-method"><span class="header-section-number">6.3</span> The Delta Method</h2>
<p>This is one of the most useful simple tools in statistics.</p>
<section id="motivating-example" class="level3 page-columns page-full" data-number="6.3.1">
<h3 data-number="6.3.1" class="anchored" data-anchor-id="motivating-example"><span class="header-section-number">6.3.1</span> Motivating example</h3>
<p>Now, for the delta method, as a first example, say we are estimating a population mean <span class="math inline">\(\mu\)</span> and are also interested in estimating <span class="math inline">\(\log(\mu)\)</span>.</p>
<div class="page-columns page-full"><p>We will probably use the sample mean <span class="math inline">\(\bar{X}\)</span> to estimate <span class="math inline">\(\mu\)</span>, and thus use <span class="math inline">\(W = \log{\bar{X}}\)</span> to estimate <span class="math inline">\(\log(\mu)\)</span>.  But how do we obtain a standard error for <span class="math inline">\(W\)</span>?</p><div class="no-row-height column-margin column-container"><span class="">If we just need to form a confidence interval for <span class="math inline">\(\log(\mu)\)</span>, we can form a CI for <span class="math inline">\(\mu\)</span> and then take the log of both endpoints. But again, standard errors are of interest in their own right.</span></div></div>
</section>
<section id="use-of-the-central-limit-theorem" class="level3" data-number="6.3.2">
<h3 data-number="6.3.2" class="anchored" data-anchor-id="use-of-the-central-limit-theorem"><span class="header-section-number">6.3.2</span> Use of the Central Limit Theorem</h3>
<p>The Central Limit Theorem tells us that <span class="math inline">\(\bar{X}\)</span> is asymptotically normally distributed. But what about <span class="math inline">\(\log{\bar{X}}\)</span>?</p>
<p>From calculus, we know that a smooth function <span class="math inline">\(f\)</span> can be written as a Taylor series,</p>
<p><span class="math display">\[
f(x) = f(x_0) + f'(x_0) (x-x_0) + f''(x_0) (x-x_0)^2 /2 + ...
\]</span></p>
<p>where ’ denotes derivative rather than matrix transpose.</p>
<p>In our case here, setting <span class="math inline">\(f(t) = \log{t}\)</span>, <span class="math inline">\(x_0 = \mu\)</span> and <span class="math inline">\(x =
\bar{X}\)</span>, we have</p>
<p><span class="math display">\[
W = \log{\mu} + \log'({\mu}) (\bar{X}-\mu) + \log''({\mu}) (\bar{X}-\mu)^2 /2 + ...
\]</span></p>
<p>and <span class="math inline">\(\log'(t) = 1/t\)</span> and so on.</p>
<p>The key point is that as n grows, <span class="math inline">\(\bar{X}-\mu\)</span> goes to 0, and <span class="math inline">\((\bar{X}-\mu)^2\)</span> goes to 0 even faster. Using theorems from probability theory, one can show that, in the sense of distribution,</p>
<p><span class="math display">\[
W \approx log(\mu) + log'(\mu) (\bar{X}-\mu)
\]</span></p>
<p>The right-hand side is a linear function of <span class="math inline">\(\overline{X}\)</span>. The latter is asymptotically normal by the Central Limit Theorem, and thus the linear function <span class="math inline">\(W\)</span> is also asymptotically normal.</p>
<p>In other words, <span class="math inline">\(W\)</span> has an approximate normal distribution that has mean <span class="math inline">\(log(\mu)\)</span> and variance</p>
<p><span class="math display">\[
\frac{1}{\mu^2} \sigma^2/n
\]</span></p>
<p>where <span class="math inline">\(\sigma^2\)</span> is the population variance <span class="math inline">\(Var(X)\)</span> . We estimate the latter by the usual <span class="math inline">\(S^2\)</span> quantity, and thus have our standard error,</p>
<p><span class="math display">\[
\textrm{s.e.}(W) = \frac{S}{\bar{X} \sqrt{n}}
\]</span></p>
</section>
<section id="use-of-the-multivariate-central-limit-theorem" class="level3 page-columns page-full" data-number="6.3.3">
<h3 data-number="6.3.3" class="anchored" data-anchor-id="use-of-the-multivariate-central-limit-theorem"><span class="header-section-number">6.3.3</span> Use of the Multivariate Central Limit Theorem</h3>
<p>Now, what if the function <span class="math inline">\(f\)</span> has two arguments instead of one? The above linear approximation is now</p>
<p><span id="eq-twotaylor"><span class="math display">\[
f(v,w) \approx f(v_0,w_0) + f_1(v_0,w_0) (v-v_0) + f_2(v_0,w_0)(w-w_0)
\tag{6.2}\]</span></span></p>
<div class="page-columns page-full"><p>where <span class="math inline">\(f_1\)</span> and <span class="math inline">\(f_2\)</span> are partial derivatives,</p><div class="no-row-height column-margin column-container"><span class="">A <em>partial derivative</em> of a function of more than one variable is the derivative with respect to one of those variables. E.g. <span class="math inline">\(\partial/\partial v ~ vw^2 =
w^2\)</span> and <span class="math inline">\(\partial/\partial w ~ vw^2 =
2vw\)</span>.</span></div></div>
<p><span class="math display">\[
f_1(v,w) = \frac{\partial}{\partial v} f(v,w)
\]</span></p>
<p><span class="math display">\[
f_2(v,w) = \frac{\partial}{\partial w} f(v,w)
\]</span></p>
<p>So if we are estimating, for instance, a population quantity <span class="math inline">\((\alpha,\beta)'\)</span> by <span class="math inline">\((Q,R)'\)</span>, standard error of the latter is the square root of</p>
<p><span class="math display">\[\begin{align}
f_1^2 (Q,R) AVar(Q) &amp;+ \\
f_2^2 (Q,R) AVar(R)
&amp;+ 2 f_1(Q,R) f_2(Q,R) ACov(Q,R)
\end{align}\]</span></p>
<p>where we have made use of <a href="Ch2a.html#eq-crossprod" class="quarto-xref">Equation&nbsp;<span>4.1</span></a>.</p>
<p>As usual, use of matrix notation can help clean up messy expressions like this. The <em>gradient</em> of <span class="math inline">\(f\)</span>, say in the two-argument case as above, is the vector</p>
<p><span class="math display">\[
\nabla f =
\left (
\begin{array}{r}
f_1 (v_0,w_0) \\
f_2 (v_0,w_0) \\
\end{array}
\right )
\]</span></p>
<p>so that <a href="#eq-twotaylor" class="quarto-xref">Equation&nbsp;<span>6.2</span></a> can be written as</p>
<p><span class="math display">\[
f(v,w) \approx f(v_0,w_0) + (\nabla f)'
\left (
\begin{array}{r}
v-v_0 \\
w-w_0 \\
\end{array}
\right )
\]</span></p>
<p>(Here ’ is matrix transpose, not a derivative.)</p>
<p>Then from <a href="Ch2a.html#eq-quadform" class="quarto-xref">Equation&nbsp;<span>4.6</span></a>,</p>
<p><span id="eq-deltaquad"><span class="math display">\[
AVar[f(Q,R)] = (\nabla f)' ACov(Q,R) (\nabla f)
\tag{6.3}\]</span></span></p>
<p>where ‘ACov’ means the asymptotic covariance matrix of the vector</p>
<p><span id="eq-covar"><span class="math display">\[
W =
\left (
\begin{array}{r}
Q \\
R  \\
\end{array}
\right )
\tag{6.4}\]</span></span></p>
<p>Let’s call that asymptotic covariance matrix <span class="math inline">\(\widehat{\Sigma}\)</span>.</p>
</section>
<section id="example-ratio-of-two-means" class="level3" data-number="6.3.4">
<h3 data-number="6.3.4" class="anchored" data-anchor-id="example-ratio-of-two-means"><span class="header-section-number">6.3.4</span> Example: ratio of two means</h3>
<p>Often <span class="math inline">\(\widehat{\Sigma}\)</span> will be provided by our application software, such as with R’s <strong>vcov</strong> function, but we will need to derive it in this case, using properties of sample means.</p>
<p>Say our sample data consists of mother-daughter pairs,</p>
<p><span class="math display">\[
\left (
\begin{array}{r}
M \\
D \\
\end{array}
\right )
\]</span></p>
<p>representing the heights of mother and daughter. Denote the population mean vector by</p>
<p><span class="math display">\[
\nu =
\left (
\begin{array}{r}
\mu_M \\
\mu_D \\
\end{array}
\right )
\]</span></p>
<p>We might be interested in the ratio <span class="math inline">\(\omega = \mu_D / \mu_M\)</span>. Our estimator will be <span class="math inline">\(\widehat{\omega} = \bar{D} / \bar{M}\)</span>, the ratio of the sample means.</p>
<p>So take <span class="math inline">\(Q = \bar{D}\)</span> and <span class="math inline">\(R =  \bar{M}\)</span>:</p>
<p><span id="eq-covdm"><span class="math display">\[
\left (
\begin{array}{r}
Q \\
R  \\
\end{array}
\right ) =
\left (
\begin{array}{r}
\bar{D} \\
\bar{M}  \\
\end{array}
\right )
\tag{6.5}\]</span></span></p>
<p>Then in <a href="#eq-deltaquad" class="quarto-xref">Equation&nbsp;<span>6.3</span></a>, with <span class="math inline">\(f(q,r) = q/r\)</span></p>
<p><span class="math display">\[
\nabla{f} =
\left (
\begin{array}{r}
1/r \\
-q/r^2  \\
\end{array}
\right )
\]</span></p>
<p>which in our application here is</p>
<p><span class="math display">\[
\nabla{f} =
\left (
\begin{array}{r}
1/\bar{M} \\
-\bar{D}/\bar{M}^2  \\
\end{array}
\right )
\]</span></p>
<p>Thus we will need <span class="math inline">\(AVar(\bar{D})\)</span>, <span class="math inline">\(AVar(\bar{M})\)</span> and <span class="math inline">\(ACov(\bar{D},\bar{M})\)</span>. These quantities are exact, not asymptotic, so we can simplify our notation, e.g.&nbsp;changing <span class="math inline">\(AVar(\bar{M})\)</span> to <span class="math inline">\(Var(\bar{M})\)</span>.</p>
<p>Be sure to distinguish between similar quantities. For example:</p>
<ul>
<li><p><span class="math inline">\(Var(M)\)</span> measures how <span class="math inline">\(M\)</span> varies across all individuals in the population,</p>
<p><span class="math display">\[
E[(M - EM)^2]
\]</span></p>
<p>We can estimate it via its sample analog:</p>
<p><span class="math display">\[
\widehat{Var}(M) =
\frac{1}{n}
\sum_{i=1}^n (M_i - \bar{M})^2
\]</span></p></li>
<li><p><span class="math inline">\(Var(\bar{M})\)</span> measures how <span class="math inline">\(\bar{M}\)</span> varies across all size-<span class="math inline">\(n\)</span> samples in the population.</p></li>
<li><p>We know from statistics that</p>
<p><span class="math display">\[
Var(\bar{M}) = \frac{1}{n} Var(M)
\]</span></p>
<p>Similar properties hold for <span class="math inline">\(Var(\bar{D})\)</span> and <span class="math inline">\(Cov(\bar{D},\bar{M})\)</span>.</p></li>
</ul>
<p>In other words, we obtain the needed covariance matrix of <a href="#eq-covdm" class="quarto-xref">Equation&nbsp;<span>6.5</span></a> as</p>
<p><span class="math display">\[
\frac{1}{n^2} \sum_{i=1}^n (W_i -\bar{W})  (W_i -\bar{W})'
\]</span></p>
<p>where</p>
<p><span class="math display">\[
W_i =
\left (
\begin{array}{r}
D_i \\
M_i  \\
\end{array}
\right )
\]</span></p>
<p>is the value of <span class="math inline">\(W\)</span> for the <span class="math inline">\(i^{th}\)</span> daughter-mother pair in our data.</p>
</section>
</section>
<section id="example-motherdaughter-height-data" class="level2" data-number="6.4">
<h2 data-number="6.4" class="anchored" data-anchor-id="example-motherdaughter-height-data"><span class="header-section-number">6.4</span> Example: Mother/Daughter Height Data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(WackyData)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Heights)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(heights)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Mheight Dheight
1    59.7    55.1
2    58.2    56.5
3    60.6    56.0
4    60.7    56.8
5    61.8    56.0
6    55.5    57.9</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> heights[,<span class="dv">1</span>]</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> heights[,<span class="dv">2</span>]</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>meanm <span class="ot">&lt;-</span> <span class="fu">mean</span>(m)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>meand <span class="ot">&lt;-</span> <span class="fu">mean</span>(d)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>fDel <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span>meanm,<span class="sc">-</span>meand<span class="sc">/</span>meanm<span class="sc">^</span><span class="dv">2</span>),<span class="at">ncol=</span><span class="dv">1</span>)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">length</span>(m)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">/</span>n) <span class="sc">*</span> <span class="fu">cov</span>(<span class="fu">cbind</span>(m,d))</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>se <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">t</span>(fDel) <span class="sc">%*%</span> sigma <span class="sc">%*%</span> fDel)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>se</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            [,1]
[1,] 0.001097201</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>meanmd <span class="ot">&lt;-</span>meanm <span class="sc">/</span> meand</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>meanmd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9796356</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(meanmd <span class="sc">-</span> <span class="fl">1.96</span><span class="sc">*</span>se, meanmd <span class="sc">+</span> <span class="fl">1.96</span><span class="sc">*</span>se)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9774850 0.9817861</code></pre>
</div>
</div>
</section>
<section id="regarding-those-pesky-derivatives" class="level2" data-number="6.5">
<h2 data-number="6.5" class="anchored" data-anchor-id="regarding-those-pesky-derivatives"><span class="header-section-number">6.5</span> Regarding Those Pesky Derivatives</h2>
<p>Though finding expressions for the derivatives in the above example was not onerous, the function <span class="math inline">\(f\)</span> can be rather complex, with the expressions for its derivatives even more complicated. Typically such tedious and error-prone operations can be avoided, by having the software calculate approximate derivatives.</p>
<p>Recall the definition of derivative:</p>
<p><span class="math display">\[
f'(x) = \lim_{w \rightarrow 0}
\frac{f(x+w) - f(x)}{w}
\]</span></p>
<p>So an aproximate value of <span class="math inline">\(f'(x)\)</span> is obtained by choosing some small value of <span class="math inline">\(w\)</span> and evaluating</p>
<p><span class="math display">\[
\frac{f(x+w) - f(x)}{w}
\]</span></p>
<p>Though of course there is an issue with one’s choice of <span class="math inline">\(w\)</span>, the point is that one can code the software to find approximate derivatives automatically using this device. <em>This is very common in Data Science libraries.</em></p>
<p>For example, the R package <strong>numDeriv</strong> will compute numerical derivatives.</p>
</section>
<section id="scheffes-method" class="level2 page-columns page-full" data-number="6.6">
<h2 data-number="6.6" class="anchored" data-anchor-id="scheffes-method"><span class="header-section-number">6.6</span> Scheffe’s Method</h2>
<p>In analyzing the Iranian Churn data above, we might form many CIs, each at the 0.95 level. However, we may wish to set an <em>overall</em> level to at least 0.95, meaning that the probability that at least one of the CIs fails to contain the desired population value is at most 0.05. This concept is known as <em>multiple inference</em> or <em>simultaneous inference</em>.</p>
<p>Whether to do this is a philosphical question, and the answer will depend on one’s goals and personal preferences, or possibly due to requirements of a research journal or employer. If we do wish to pursue the matter, then how? One of the most well-known approaches makes good use of linear algebra.</p>
<section id="a-confidence-set-for-widehatbeta-in-the-linear-model" class="level3 page-columns page-full" data-number="6.6.1">
<h3 data-number="6.6.1" class="anchored" data-anchor-id="a-confidence-set-for-widehatbeta-in-the-linear-model"><span class="header-section-number">6.6.1</span> A confidence set for <span class="math inline">\(\widehat{\beta}\)</span> in the linear model</h3>
<div class="page-columns page-full"><p> It can be shown that if a random vector <span class="math inline">\(W\)</span> has a <span class="math inline">\(k\)</span>-dimensional normal distribution random vector with mean vector <span class="math inline">\(\mu\)</span> and covariance matrix <span class="math inline">\(\Sigma\)</span>, then</p><div class="no-row-height column-margin column-container"><span class="">The chi-square distribution with <span class="math inline">\(k\)</span> degrees of freedom is defined to be the distribution of the sum of the squares of <span class="math inline">\(k\)</span> independent N(0,1) random variables. After applying properties such as <a href="Ch2a.html#eq-acova" class="quarto-xref">Equation&nbsp;<span>4.5</span></a>, one can show that the quadratic form here also has that distribution.</span></div></div>
<p><span class="math display">\[
Q = (W-\mu)' \Sigma^{-1} (W-\mu)
\]</span></p>
<p>has a <em>chi-square</em> distribution with <span class="math inline">\(k\)</span> <em>degrees of freedom</em>. Say <span class="math inline">\(d_{\alpha}\)</span> is the upper-<span class="math inline">\(\alpha\)</span> quantile of that distribution, i.e.</p>
<p><span class="math display">\[
P[(W-\mu)' \Sigma^{-1} (W-\mu) \leq d_{\alpha}] = 1-\alpha
\]</span></p>
<p>In the case <span class="math inline">\(k=2\)</span>, the set of all <span class="math inline">\(t = (t_1,...,t_k)'\)</span> such that</p>
<p><span class="math display">\[
(t-\mu)' \Sigma^{-1} (t-\mu) = d_{\alpha}
\]</span></p>
<p>is an ellipse. (If <span class="math inline">\(\Sigma = I\)</span>, we have a circle.) For <span class="math inline">\(k=3\)</span> we have an ellipsoid, a “football,” and so on in higher dimensions..</p>
<div class="page-columns page-full"><p> Now, in the context of the linear model, take <span class="math inline">\(W\)</span> to be <span class="math inline">\(\widehat{\beta}\)</span>, <span class="math inline">\(\mu = \beta\)</span> etc. Here <span class="math inline">\(\Sigma\)</span> must be estimated by <span class="math inline">\(\widehat{\Sigma}\)</span> (given to us via <strong>vcov</strong>), so we should replace the chi-square distribution by the <em>F-distribution</em>. But for simplicity, let’s stick with chi-square, which is a good approximation for large <span class="math inline">\(n\)</span> anyway.</p><div class="no-row-height column-margin column-container"><span class="">We will use the linear model here for concretenss, but the same analysis holds for any asymptotically normal statistical estimator, e.g. Maximum Likelihood estimates.</span></div></div>
<p>So, the event</p>
<p><span class="math display">\[
(\widehat{\beta}-\beta)' \widehat{\Sigma}^{-1} (\widehat{\beta}-\beta)
\leq d_{\alpha}
\]</span></p>
<p>has probability <span class="math inline">\(1-\alpha\)</span>. Equivalently, the event</p>
<p><span id="eq-Falpha"><span class="math display">\[
(\beta - \widehat{\beta})' \widehat{\Sigma}^{-1} (\beta-\widehat{\beta})
\leq d_{\alpha}
\tag{6.6}\]</span></span></p>
<p>has that probability as well.</p>
<blockquote class="blockquote">
<p>Therefore, the set of all <span class="math inline">\(\beta\)</span> satisfying <a href="#eq-Falpha" class="quarto-xref">Equation&nbsp;<span>6.6</span></a> is a <span class="math inline">\(100(1-\alpha)\)</span> confidence set for the true population <span class="math inline">\(\beta\)</span>.</p>
</blockquote>
<p>This gives us a confidence ellipse for <span class="math inline">\(\beta\)</span> in two dimensions, a confidence ellipsoid in three dimensions and so on.</p>
<p>The <strong>ellipse</strong> library can draw this for us:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ellipse)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(mtcars)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(mpg <span class="sc">~</span> disp <span class="sc">+</span> cyl , mtcars)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">ellipse</span>(fit, <span class="at">which =</span> <span class="fu">c</span>(<span class="st">'disp'</span>, <span class="st">'cyl'</span>), <span class="at">level =</span> <span class="fl">0.90</span>), <span class="at">type =</span> <span class="st">'l'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Ch3a_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Here the axes are <span class="math inline">\(\beta_{disp}\)</span> and <span class="math inline">\(\beta_{cyl}\)</span>.</p>
<p>By the way, note that the smaller <span class="math inline">\(\alpha\)</span> is, the larger will be the value of <span class="math inline">\(d_{\alpha}\)</span>, thus the larger the ellipse. The reader should pause to confirm that this makes sense.</p>
<p>However, this is but an itermediate step toward our goal of a multiple inference method. Our next step will be to set up a math tool.</p>
</section>
<section id="sec-lagrange" class="level3" data-number="6.6.2">
<h3 data-number="6.6.2" class="anchored" data-anchor-id="sec-lagrange"><span class="header-section-number">6.6.2</span> Lagrange multipliers</h3>
<p>In <a href="Ch3.html" class="quarto-xref"><span>Chapter 5</span></a>, we saw the power of matrix derivatives, in our case to minimize a sum of squares. Here we go one step further, again doing optimization, but in this case under a constraint. To this end, we first need to introduce the concept of <em>Lagrange multipliers</em>.</p>
<p>The context is that we wish to minimize/maximize a quantity <span class="math inline">\(f(w)\)</span>, subject to <span class="math inline">\(g(w) = 0\)</span>, where <span class="math inline">\(w\)</span> is a vector argument. We set up the expression <span class="math inline">\(f(w) + \lambda g(w)\)</span>, and find its extreme values.</p>
<p>For instance, say we wish to minimize</p>
<p><span class="math display">\[
f(x,y) = x^2 + 2y^2
\]</span></p>
<p>subject to the constraint.</p>
<p><span id="eq-constraint"><span class="math display">\[
3x + y = 8
\tag{6.7}\]</span></span></p>
<p>We form the expression</p>
<p><span class="math display">\[
x^2 + 2y^2 + \lambda (3x + y - 8)
\]</span></p>
<p>xxx</p>
<p>and take partial derivatives with respect to <span class="math inline">\(x\)</span>, <span class="math inline">\(y\)</span> and <span class="math inline">\(\lambda\)</span>:</p>
<p><span class="math display">\[
0 = 2x + 3 \lambda
\]</span></p>
<p><span class="math display">\[
0 = 4y + \lambda
\]</span></p>
<p><span class="math display">\[
0 = 3x+y-8
\]</span></p>
<p>From the first two equations, we have</p>
<p><span class="math display">\[
0 = 2x - 12y
\]</span></p>
<p>Substituting into <a href="#eq-constraint" class="quarto-xref">Equation&nbsp;<span>6.7</span></a>, we find that</p>
<p><span class="math display">\[
y = \frac{8}{19}
\]</span></p>
<p>and so on.</p>
<p>The Lagrange multiplier here is <span class="math inline">\(\lambda\)</span>. If we have several constraints, we have several multipliers.</p>
</section>
<section id="simultaneous-confidence-intervals-for-quantities-abeta" class="level3 page-columns page-full" data-number="6.6.3">
<h3 data-number="6.6.3" class="anchored" data-anchor-id="simultaneous-confidence-intervals-for-quantities-abeta"><span class="header-section-number">6.6.3</span> Simultaneous confidence intervals for quantities <span class="math inline">\(a'\beta\)</span></h3>
<p>In <a href="#sec-rcov" class="quarto-xref"><span>Section 6.2</span></a>, we saw how to form confidence intervals for a quantity <span class="math inline">\(a'\beta\)</span>. We may wish to form several, or even many, such intervals. Here is how the Scheffe’ method can make the intervals simultaneous.</p>
<div class="page-columns page-full"><p> To find a CI for <span class="math inline">\(a'\beta\)</span>, we find its maximum and minimum values subject to <span class="math inline">\(\beta\)</span> being in the ellipsoid. In other words, we solve the Lagrange multiplier problem</p><div class="no-row-height column-margin column-container"><span class="">There is an easily-missed subtlety here. Our phrasing “subject to <span class="math inline">\(\beta\)</span> being <em>in</em> the ellipsoid” (i.e.&nbsp;either in the interior or on the boundary) is at odds with the Langrange formulation, which stipulates that the min or max values occur on the boundary. But the latter property is implied by the linearity of <span class="math inline">\(a'\beta\)</span>: Consider any point <span class="math inline">\(q\)</span> that is strictly interior to the ellipsoid, so our objective function has value <span class="math inline">\(a'q\)</span>. Then there is room for us to move away from <span class="math inline">\(q\)</span> yet still be inside the ellipsoid, say to the point <span class="math inline">\(u\)</span>, yet with <span class="math inline">\(a'u\)</span> either larger or smaller that <span class="math inline">\(a'q\)</span>, depending on the direction we move in. So the min or max cannot be in the interior.</span></div></div>
<p><span id="eq-scheffeobjftn"><span class="math display">\[
min, max_{\beta, \lambda} ~~
a'\beta + \lambda [(\beta - \widehat{\beta})'
\widehat{\Sigma}^{-1} (\beta-\widehat{\beta}) - d_{\alpha}]
\tag{6.8}\]</span></span></p>
<p>Those max and min values then define our CI.</p>
<p>Let <span class="math inline">\(C\)</span> be a symmetric matrix. The derivative of a quadratic form <span class="math inline">\(u'Cu\)</span> with respect to <span class="math inline">\(u\)</span> can be shown to be <span class="math inline">\(2Cu\)</span>. Differentiating with respect to <span class="math inline">\(\beta\)</span>, we thus have</p>
<p><span class="math display">\[
0 = a
+ 2 \lambda
[\widehat{\Sigma}^{-1} (\beta - \widehat{\beta})]
\]</span></p>
<p>so that</p>
<p><span id="eq-sothat"><span class="math display">\[
\beta - \widehat{\beta} =
-\frac{1}{2 \lambda}
\widehat{\Sigma} a
\tag{6.9}\]</span></span></p>
<p>Now substitute for <span class="math inline">\(\beta - \widehat{\beta}\)</span> in the constraint:</p>
<p><span class="math display">\[
d_{\alpha} =
(-\frac{1}{2\lambda} \widehat{\Sigma} a)' \widehat{\Sigma}^{-1}
(-\frac{1}{2 \lambda} \widehat{\Sigma} a) =
\frac{1}{4 \lambda^2} (a' \widehat{\Sigma} a)
\]</span></p>
<p>Solve for <span class="math inline">\(\lambda\)</span>:</p>
<p><span class="math display">\[
2 \lambda = \pm \sqrt{\frac{1}{d_{\alpha}} a'\widehat{\Sigma} a}
\]</span></p>
<p>Finally, recall that the quantity whose min and max interest us is <span class="math inline">\(a'\beta\)</span>. Using <a href="#eq-sothat" class="quarto-xref">Equation&nbsp;<span>6.9</span></a>, we have our CI for <span class="math inline">\(a'\beta\)</span>,</p>
<p><span id="eq-scheffeci"><span class="math display">\[
a'\widehat{\beta} \pm
\sqrt{d_{\alpha} a'\widehat{\Sigma} a}
\tag{6.10}\]</span></span></p>
<p>Now, why does this interval hold <em>simultaneously</em> over <em>all</em> <span class="math inline">\(a\)</span>? The point is that once we know <span class="math inline">\(\beta\)</span> is in the ellipsoid, then the above algebraic computations show that for <em>any</em> <span class="math inline">\(a\)</span>, the quantity <span class="math inline">\(a'\beta\)</span> will be between <span class="math inline">\(a'\widehat{\beta} - \sqrt{d_{\alpha} a'\widehat{\Sigma}
a}\)</span> and <span class="math inline">\(a'\widehat{\beta} + \sqrt{d_{\alpha} a'\widehat{\Sigma} a}\)</span>. Again, this is solely an algebraic property, not a probabilistic one; the only probabilistic action occurred in <span class="math inline">\(\beta\)</span> being in the ellipsoid. Thus <a href="#eq-scheffeci" class="quarto-xref">Equation&nbsp;<span>6.10</span></a> will hold for all <span class="math inline">\(a\)</span> simultaneously.</p>
<p>However, note that we pay a price for the simultaneity, in that <a href="#eq-scheffeci" class="quarto-xref">Equation&nbsp;<span>6.10</span></a> will be wider than the ordinary CI for <span class="math inline">\(a'\beta\)</span>, using <a href="#eq-pmse" class="quarto-xref">Equation&nbsp;<span>6.1</span></a>,</p>
<p><span class="math display">\[
a'\widehat{\beta} \pm
z_{\alpha} \sqrt{a'\widehat{\Sigma} a}
\]</span></p>
<p>Consider our Iranian Churn data analysis above, with <span class="math inline">\(k = 12\)</span>. Let’s find <span class="math inline">\(\sqrt{d_{\alpha}}\)</span>, for <span class="math inline">\(\alpha = 0.05\)</span>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(<span class="fu">qchisq</span>(<span class="fl">0.95</span>,<span class="dv">12</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4.585419</code></pre>
</div>
</div>
<p>By contrast, <span class="math inline">\(z_{\alpha} = 1.96\)</span>. The Scheffe’ interval is more than twice as wide. As the saying goes, there is no “free lunch.”</p>
</section>
</section>
<section id="your-turn" class="level2" data-number="6.7">
<h2 data-number="6.7" class="anchored" data-anchor-id="your-turn"><span class="header-section-number">6.7</span> Your Turn</h2>
<p>❄️ <strong>Your Turn:</strong> In the mother/daughter data, find the estimated covariance between the two heights.</p>
<p>❄️ <strong>Your Turn:</strong></p>
<p>Write an R function with call form</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">regFtnCI</span>(lmOut,t,alpha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>that returns an approximate <span class="math inline">\((1-\alpha)\)</span> confidence interval for the conditional mean <span class="math inline">\(E(Y | X=t)\)</span>. Here <strong>lmOut</strong> is the object returned by a call to <strong>lm</strong>.</p>
<p>❄️ <strong>Your Turn:</strong></p>
<p>The <em>geometric mean</em> of a set of <span class="math inline">\(n\)</span> numbers is the <span class="math inline">\(n^{th}\)</span> root of their product. Write an R function with call form</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">geoGMxbarybar</span>(x,y,alpha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>that returns an approximate <span class="math inline">\(100(1-\alpha)\)</span> percent CI for the population geometric mean of the two numbers <span class="math inline">\(E(X)\)</span> and <span class="math inline">\(E(Y)\)</span>, using the sample analog</p>
<p><span class="math display">\[
\sqrt{\bar{x} ~ \bar{y}}
\]</span></p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./Ch3.html" class="pagination-link" aria-label="Linear Statistical Models">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Linear Statistical Models</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./Ch4.html" class="pagination-link" aria-label="Matrix Rank">
        <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Matrix Rank</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>